
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="ja"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>mike、mikeなるままに…</title>

  
  <meta name="description" content="こんにちわ、みけです。 昨日(2013/08/19)に開催されたJJUGのLT大会でLTをしてきました。 LTの内容ですが、 ネタLTとしては大成功(?)でしたが、 まあJavaのLTとしては疑問符が残るものを発表しました。 とりあえず、JavaFXの部分だけ抽出して書きたいと思います。 要望・ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mike-neck.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="mike、mikeなるままに…" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
<meta property="og:title" content="mike、mikeなるままに…" />
<meta property="og:type" content="blog" />
<meta property="og:description" content="" />


<meta property="og:image" content="http://mike-neck.github.io/mike-pow.png"/>

<meta property="og:url" content="http://mike-neck.github.io/" />
<meta property="og:author" content="mike-neck" />
<meta property="og:site_name" content="mike、mikeなるままに…" />
<meta property="og:locale" content="ja_JP" />
<meta property="fb:app_id" content="531007270298287" />

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-40855644-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">mike、mikeなるままに…</a></h1>
  
    <h2>プログラムに関してぬるま湯のような記事を書きます</h2>
  
  <valuecommerce   ptnOid="3060695" url="http://mike-neck.github.io/" />
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:mike-neck.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/08/19/jjug-ltda-hui-dehua-sitanei-rong-falseyao-dian/">JJUG LT大会で話した内容の要点</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-19T21:27:00+09:00" pubdate data-updated="true">Aug 19<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://googledrive.com/host/0B4hhdHWLP7RRUDdMU0xjS3NKTG8" style="width : 400px;"/></p>

<p>こんにちわ、みけです。</p>

<p>昨日(2013/08/19)に開催されたJJUGのLT大会でLTをしてきました。</p>

<p>LTの内容ですが、</p>

<p>ネタLTとしては大成功(?)でしたが、</p>

<p>まあJavaのLTとしては疑問符が残るものを発表しました。</p>

<p>とりあえず、JavaFXの部分だけ抽出して書きたいと思います。</p>

<h2>要望・仕様</h2>

<p>ウケ狙いをしたLTの「冒険者の広場』のページについて、次のような要望・仕様になっています。</p>

<ul>
<li>定期的にWebの情報を取得したい</li>
<li>Web APIが公開されていない</li>
<li>リンク先のURLがJavascriptでのクリックにバインドされた関数に記載されている</li>
</ul>


<h2>スクレイピングツールの候補</h2>

<p>Javaで利用できるスクレイピングツールおよびブラウザーは次のものが主に挙げられます</p>

<ul>
<li>NekoHTML/Jsoup</li>
<li>HtmlUnit</li>
<li>Selenium</li>
<li>JavaFXのWebEngine</li>
</ul>


<h3>NekoHtml</h3>

<p>Java1.3以降から使えるHTMLパーサーです。</p>

<p>古くてかつ最近は更新が遅いようです。</p>

<p>最新のHTMLをパースするのには向いていません。</p>

<p>パースするだけなのでJavascriptの実行はできません。</p>

<p>したがって、採用しませんでした。</p>

<h3>Jsoup</h3>

<p>HTML5のタグにも対応したHTMLパーサーです。</p>

<p>要素の取得などは非常に便利なのですが、</p>

<p>これもHTMLをパースするだけでJavascriptの実行はできません。</p>

<p>したがって、採用しませんでした。</p>

<h3>HtmlUnit</h3>

<p>NekoHtmlをHTMLパーサーとして利用したヘッドレスブラウザーです。</p>

<p>Javascriptの実行にRhinoを使っています。</p>

<p>僕自信の目的にはこれで十分な機能だったのですが、</p>

<p>残念ながら『冒険者の広場』を表示しようとしたら、</p>

<p>Javascriptエラーが発生したので、</p>

<p>採用しませんでした。</p>

<h3>Selenium</h3>

<p>言わずと知れたFireFoxの自動実行ツールです。</p>

<p>ブラウザの操作を覚えさせることも可能なため、</p>

<p>比較的スクリプトを作るのが楽です。</p>

<p>しかし、個人的にはブラウザーがポコポコ立ち上がるのが</p>

<p>好きでないので採用しませんでした。</p>

<h3>JavaFXのWebEngine</h3>

<p>レンダリングエンジンにWebKitを採用したブラウザーです。</p>

<p>Javascriptの実行にRhinoが使われています。</p>

<p>JavaFXのアプリケーション側からJavascriptの実行も指示することができます。</p>

<p>好みであれば画面を立ち上げることなしに実行できます。</p>

<p>特に文句をつけるところもないので採用しました。</p>

<h2>JavaFXをヘッドレスブラウザーとして使う時のやり方</h2>

<h3><code>Application</code>を継承したクラス</h3>

<p>JavaFXのアプリケーションですので、<code>Application</code>クラスを継承したクラスを作成します。</p>

<figure class='code'><figcaption><span>DqxWebDriver.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DqxWebDriver</span> <span class="kd">extends</span> <span class="n">Application</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="n">WebEngine</span> <span class="n">engine</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">URL</span> <span class="o">=</span> <span class="s">&quot;…&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">Stage</span> <span class="n">stage</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">engine</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebEngine</span><span class="o">();</span>
</span><span class='line'>        <span class="n">engine</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">URL</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ここでのポイントは2つです。</p>

<ul>
<li><code>start</code>メソッドの中で<code>WebEngine</code>のインスタンスを生成すること</li>
<li>特に画面を表示する必要がないので、<code>stage.show()</code>を実行しないこと</li>
</ul>


<h3>JavaFXの起動と終了</h3>

<p><code>Application.launch(Class&lt;? extends Application&gt;)</code>を実行すればいいのですが、</p>

<p>これを実行するとJavaFXアプリケーションを実行している間は</p>

<p>何もできなくなるため、別のスレッドで実行する必要があります。</p>

<figure class='code'><figcaption><span>Bazaar.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ExecutorService</span> <span class="n">service</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'><span class="n">service</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">(){</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Application</span><span class="o">.</span><span class="na">launch</span><span class="o">(</span><span class="n">DqxWebDriver</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">});</span>
</span><span class='line'><span class="c1">// Do some operation</span>
</span><span class='line'><span class="n">Platform</span><span class="o">.</span><span class="na">exit</span><span class="o">();</span>
</span><span class='line'><span class="n">service</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>JavaFXの終了には<code>Platform.exit()</code>を実行します。</p>

<p>これによりJavaアプリケーション自体が起動したままになるのを防ぐことができます。</p>

<h3>Javascriptの実行</h3>

<p><code>WebEngine</code>の<code>executScript(String)</code>を実行します。</p>

<figure class='code'><figcaption><span>DqxWebDriver.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="n">WebEngine</span> <span class="n">engine</span><span class="o">;</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">executeScript</span><span class="o">(</span>
</span><span class='line'>        <span class="kd">final</span> <span class="n">String</span> <span class="n">script</span><span class="o">,</span>
</span><span class='line'>        <span class="kd">final</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Platform</span><span class="o">.</span><span class="na">runLater</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">(){</span>
</span><span class='line'>        <span class="n">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="na">executScript</span><span class="o">();</span>
</span><span class='line'>        <span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
</span><span class='line'>    <span class="o">});</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>WebEngine</code>の操作はJavaFXのApplication Threadから実行しなければなりません。</p>

<p>そのために、<code>Platform.runLater(Runnable)</code>を介して実行する必要があります。</p>

<p>引数は<code>Runnable</code>のために、戻り値を利用することができません。</p>

<p>そのために、<code>BlockingQueue&lt;T&gt;</code>を使っています。</p>

<p><code>WebEngine#executeScript(String)</code>の戻り値をここでは<code>Object</code>として利用していますが、</p>

<p>戻り値は実際には次のようにマッピングされます。</p>

<table style="border-collapse : collapse;">
<tr><th style="border : solid 1px #039; margin : 2px;">Javascriptでの型</th><th style="border : solid 1px #039; margin : 2px;">Javaでの型</th></tr>
<tr><td style="border : solid 1px #039; margin : 2px;">boolean</td><td style="border : solid 1px #039; margin : 2px;">Boolean</td></tr>
<tr><td style="border : solid 1px #039; margin : 2px;">number(整数値)</td><td style="border : solid 1px #039; margin : 2px;">Integer</td></tr>
<tr><td style="border : solid 1px #039; margin : 2px;">number(少数値)</td><td style="border : solid 1px #039; margin : 2px;">Double</td></tr>
<tr><td style="border : solid 1px #039; margin : 2px;">string</td><td style="border : solid 1px #039; margin : 2px;">String</td></tr>
<tr><td style="border : solid 1px #039; margin : 2px;">object</td><td style="border : solid 1px #039; margin : 2px;">netscape.javascript.JSObject</td></tr>
<tr><td style="border : solid 1px #039; margin : 2px;">function</td><td style="border : solid 1px #039; margin : 2px;">netscape.javascript.JSObject</td></tr>
<tr><td style="border : solid 1px #039; margin : 2px;">null</td><td style="border : solid 1px #039; margin : 2px;">null</td></tr>
</table>


<p>Javascriptでの配列は<code>object</code>ですので、JSObjectにマッピングされます。</p>

<p><code>JSObject</code>のあ使い方ですが、<code>getMember(String)</code>と<code>getSlot(int)</code>を用いて値にアクセスします。</p>

<h4>getMemberメソッド</h4>

<p><code>{hoge : "hoge", foo : 10}</code>というオブジェクトの場合、</p>

<p>次のように<code>getMember(String)</code>メソッドを使用して値を取り出します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">String</span> <span class="n">hoge</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">object</span><span class="o">.</span><span class="na">getMember</span><span class="o">(</span><span class="s">&quot;hoge&quot;</span><span class="o">);</span>
</span><span class='line'><span class="kt">int</span> <span class="n">foo</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">object</span><span class="o">.</span><span class="na">getMember</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<h4>getSlotメソッド</h4>

<p><code>[1,2,3,4,5]</code>という配列の場合、</p>

<p>次のように<code>getSlot(int)</code>メソッドを用いて値を取り出します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kt">int</span> <span class="n">one</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">object</span><span class="o">.</span><span class="na">getSlot</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'><span class="kt">int</span> <span class="n">two</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">object</span><span class="o">.</span><span class="na">getSlot</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'><span class="kt">int</span> <span class="n">five</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">object</span><span class="o">.</span><span class="na">getSlot</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<h3>WebEngineの同期</h3>

<p>先ほど書いたように、WebEngineへの操作は別スレッドで実行することになりますが、</p>

<p>さらにJavaFX ApplicationスレッドとWebEngineは異なるスレッドで実行されています。</p>

<p>したがって、WebEngineの動作に合わせてアプリケーションの実行をしたいシーンが発生すると思います。</p>

<p>その場合、<code>getLoadWorker</code>メソッドで<code>Worker</code>を取得して、<code>getState</code>にて</p>

<p>WebEngineの状態を確認する必要があります。</p>

<figure class='code'><figcaption><span>DqxWebDriver.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="n">WebEngine</span> <span class="n">engine</span><span class="o">;</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">Worker</span><span class="o">.</span><span class="na">State</span> <span class="nf">getEngineState</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">final</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Worker</span><span class="o">.</span><span class="na">State</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BlockingQueue</span><span class="o">&lt;&gt;();</span>
</span><span class='line'>    <span class="n">Platform</span><span class="o">.</span><span class="na">runLater</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">(){</span>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">engine</span><span class="o">.</span><span class="na">getLoadWorker</span><span class="o">().</span><span class="na">getState</span><span class="o">());</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">});</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>この結果が<code>Worker.State.RUNNING</code>の間は、</p>

<p>Javascriptの実行などをしているため、</p>

<p>戻り値を利用するなどのアプリケーション操作はできません。</p>

<p>したがって、<code>Thread.sleep(long)</code>等で停止しておくとよいでしょう。</p>

<figure class='code'><figcaption><span>DqxWebDriver.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">waitForEngine</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Worker</span><span class="o">.</span><span class="na">State</span> <span class="n">state</span> <span class="o">=</span> <span class="n">Worker</span><span class="o">.</span><span class="na">State</span><span class="o">.</span><span class="na">RUNNING</span><span class="o">;</span>
</span><span class='line'>    <span class="k">while</span><span class="o">(</span><span class="n">state</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">Worker</span><span class="o">.</span><span class="na">State</span><span class="o">.</span><span class="na">RUNNING</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="n">l</span><span class="o">);</span>
</span><span class='line'>        <span class="n">state</span> <span class="o">=</span> <span class="n">getEngineState</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>おわり</h2>

<p>以上が昨日全くもって話しえなかったことです。</p>

<p>スレッド周りが非常に面倒な感じがしますが、</p>

<p>慣れればあとはJavascriptを好きに実行できるので、</p>

<p>WebアプリでのJavascriptのテストなどで活用できたりします。</p>

<!-- admax -->


<script type="text/javascript" src="http://adm.shinobi.jp/s/d0f95faac716337846b3bcf82925c26e"></script>


<!-- admax -->




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40855644-1', 'github.io');
  ga('send', 'pageview');

</script>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/08/08/chao-gao-su-kai-fa-turuniguan-siteiroirotosi-tutakoto/">超高速開発ツールに関していろいろと思ったこと</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-08T11:29:00+09:00" pubdate data-updated="true">Aug 8<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://googledrive.com/host/0B4hhdHWLP7RRbkJ6SFVwUHM0NDQ" style="width : 450px;"/></p>

<p>こんにちわ、みけです。</p>

<p>先月末は体調がすこぶる悪くて、ブログも何もしていませんでした。</p>

<h2>超高速開発コミュニティ</h2>

<p>さて、プログラマーの皆様にも、SIer諸氏の皆様にも</p>

<p>なんだか香ばしい話題が各種メディアから出ましたね。</p>

<ul>
<li><a href="http://www.publickey1.jp/blog/13/31013.html">超高速開発はスクラッチ開発の3倍から10倍の開発効率が条件、競合するベンダ13社が利害を超えて「超高速開発コミュニティ」を設立</a></li>
<li><a href="http://www.atmarkit.co.jp/ait/articles/1308/06/news121.html">プロフェッショナルたちの熱い想い： 「超高速開発コミュニティ」を設立――日本が19位で黙っているわけにはいかない</a></li>
<li><a href="http://itpro.nikkeibp.co.jp/article/NEWS/20130806/496983/">開発ツールベンダー13社が集結し、「超高速開発コミュニティ」を設立</a></li>
<li><a href="http://japan.zdnet.com/development/analysis/35035688/">競合関係を超えた意義で発足した「超高速開発コミュニティ」とは</a></li>
</ul>


<p>また、設立にあたって関係者のブログが公開されています。</p>

<ul>
<li><a href="http://yoshinorinie.hatenablog.com/entry/2013/08/07/093056">「超高速開発コミュニティ」は何を目指すのか &ndash; ジャスミンソフト日記</a></li>
</ul>


<h2>各種の反応</h2>

<p>publickeyで取り上げられたから、プログラマーの皆様の反応も早く、</p>

<ul>
<li>プログラマーの待遇を良くすれば開発速度が云々</li>
<li>意思決定の速いマネージメントに変えれば云々</li>
<li>無駄な成果物(エクセルファイル)を作らなければ云々</li>
</ul>


<p>といったツイートが見られました。</p>

<p>また、これに便乗したセールをやっている輩もいるようです。</p>

<ul>
<li><a href="http://samuraism.com/2013/08/07/1382">#超高速セール – 本日のみAppCode、WebStorm、RubyMine、PhpStorm、PyCharm、ReSharperパーソナルライセンス1000円引き(本セールは超高速に終了いたしました) &ndash; samuraism</a></li>
</ul>


<p>プログラマーの方のブログでも様々な意見があるようです。</p>

<ul>
<li><a href="http://d.hatena.ne.jp/gothedistance/20130808/1375927241">超高速開発が目指す未来像は何なのか &ndash; GoTheDistance</a></li>
<li><a href="http://d.hatena.ne.jp/dkfj/20130808/1375944889">「超高速開発と聞いて思うところ。或いは、アジャイル開発が目指すところ」- プログラマになりたい</a></li>
</ul>


<h2>僕自信の考え</h2>

<p>まあ、反応を取り上げたところで、お前自身はどうなんだよという話になりますね。</p>

<p>僕としては、こういうツールは使える場面ではどんどん適用すればいいと思っています。</p>

<p>ただし、このツール類、多少のIT業界でのパラダイムシフトが必要だと思っています。</p>

<h3>従来のITシステムを作るときの役割</h3>

<div style="position : relative; border : solid 5px #999966; background-color : #ffffcc; width : 550px; height : 170px; border-radius : 10px; padding : 20px;">
<div style="position : relative; top : 0px; left : 0px; border : solid 5px #039; background-color : #9cf; width : 110px; height : 150px; border-radius : 10px; text-align : center; color : #039; display: table-cell; vertical-align : middle;">ユーザー企業<br/><br/>アプリケーションへの要求</div>
<div style="position : relative; top : 0px; left : 0px; width : 100px; text-align : center; color : #666; display: table-cell; vertical-align : middle;">発注<br/>→<br/><br/>←<br/>アプリケーション</div>
<div style="position : relative; top : 0px; left : 0px; border : solid 5px #930; background-color : #fcc; width : 110px; height : 150px; border-radius : 10px; text-align : center; color : #930; display: table-cell; vertical-align : middle;">SIer<br/><br/>アプリケーション開発</div>
<div style="position : relative; top : 0px; left : 0px; width : 100px; text-align : center; color : #666; display: table-cell; vertical-align : middle;">選定<br/>→<br/><br/>←<br/>ソフトウェア</div>
<div style="position : relative; top : 0px; left : 0px; border : solid 5px #393; background-color : #9f9; width : 110px; height : 150px; border-radius : 10px; text-align : center; color : #060; display: table-cell; vertical-align : middle;">各種<br/>ベンダー<br/><br/>ハード・ミドル・ソフトの提供</div>
</div>


<p>まあ、多少の異なるところはあれ、だいたいこの形になっていると思います。</p>

<p>このスキームでの超高速開発ツールの問題点は、</p>

<p>ツールの採用の如何がSIerにかかっているということです。</p>

<p>で、当のSIerにおいては社員の雇用を確保するという義務があったりする関係上、</p>

<p>(ここでは結構大きめなSIerを前提としています)</p>

<p>工数が少なくなる(人数を減らしてしまう)ような開発手法は採用できないため、</p>

<p>超高速開発ツールの採用を見合わせたりします。</p>

<p>もちろん、以下の様な理由もあったりするでしょう。</p>

<ul>
<li>超高速開発ツールに関するノウハウがない</li>
<li>フルスクラッチでしか成功経験がない</li>
<li>社内の評価が売上高なので、人月で積み上げられる開発モデルが望ましい</li>
<li>フルスクラッチで開発して若手社員を教育したい</li>
</ul>


<p>こういった、SIerの思惑にはユーザーの視点というものが欠けているように思われます。</p>

<p>まあ、実際に欠けているわけで、大枚をはたいて完成したシステムが使えないなんてことが</p>

<p>あったり、なかったり…</p>

<p>また、ユーザー企業としても、業務での情報の活用度を高めたいけど、</p>

<p>元が取れるのかどうかわからないものに、</p>

<p>100人月(1億円くらい？)を払っていいものかどうかがわからないなんてことも</p>

<p>あるかもしれません。</p>

<p>以上から、従来のスキームでユーザー企業はITを必要としていても、</p>

<p>ITの恩恵が受けられないみたいな状態になってしまうかもしれません。</p>

<p>なんとなく、企業とITに関してSIerがガンになっている気がしなくもないですね。</p>

<p>超高速開発コミュニティが気にしているのは、</p>

<p>この状態なのかもしれません。</p>

<h3>超高速開発ツールを活用する場合の各業界の役割</h3>

<p>で、超高速開発コミュニティが目指しているのは次のようなスキームなのではないかと思っています。</p>

<div style="position : relative; border : solid 5px #999966; background-color : #ffffcc; width : 340px; height : 170px; border-radius : 10px; padding : 20px;">
<div style="position : relative; top : 0px; left : 0px; border : solid 5px #039; background-color : #9cf; width : 110px; height : 150px; border-radius : 10px; text-align : center; color : #039; display: table-cell; vertical-align : middle;">ユーザー企業<br/><br/>業務ツール作成</div>
<div style="position : relative; top : 0px; left : 0px; width : 100px; text-align : center; color : #666; display: table-cell; vertical-align : middle;">購入<br/>→<br/><br/>←<br/>ツール</div>
<div style="position : relative; top : 0px; left : 0px; border : solid 5px #393; background-color : #9f9; width : 110px; height : 150px; border-radius : 10px; text-align : center; color : #060; display: table-cell; vertical-align : middle;">ツール<br/>ベンダー<br/><br/>ツールの提供</div>
</div>


<p>癌であるSIerは取り除いて、</p>

<p>ユーザー企業が超高速開発ツールを活用して、</p>

<p>自分たちの必要な物を作る。</p>

<p>これなら、ユーザー企業は</p>

<ul>
<li>自分たちの欲しいアプリケーション作れるし</li>
<li>すぐにアプリケーションを使えるし</li>
<li>プログラミング言語わかってなくても作れるし</li>
<li>費用がそんなにかからないし</li>
</ul>


<p>といいことづくめになるわけですね。</p>

<p>で、こういうところがおそらく超高速開発コミュニティの目指しているところ</p>

<p>であると僕は考えています。</p>

<p>(違うかもしれませんけどね)</p>

<p>お気づきのことだと思いますが、この図では、あえてSIerの枠を無くしています。</p>

<p>&mdash;&ndash; え、SIer、どうなっちゃうの？死ぬの？</p>

<p>&mdash;&ndash; はい、死んでください。</p>

<p>まあ、半分冗談ですが、半分本気です。</p>

<p>半分冗談と言ったのは、超高速開発ツールを提供するとはいえ、</p>

<p>単なるソフトウェア・ベンダーなので、顧客業務にどのツールが適しているかどうかを</p>

<p>判断するような役割の仕事は残っていると思います。</p>

<p>その部分にかろうじてSIerが残れると思います。</p>

<p>で、半分本気なところですが、</p>

<p>超高速開発コミュニティの発表後日談的位置づけのエントリー</p>

<p><a href="http://yoshinorinie.hatenablog.com/entry/2013/08/08/181931">超高速開発コミュニティ- 記者会見から二日目の状況 &ndash; ジャスミンソフト日記</a></p>

<p>に次のような記述があります。</p>

<blockquote><p>記者発表の場で幹事の樋山さんから発言がありましたが、超高速開発を実現するという各社のツールは具体的にどういうもので、各ツールの違いは何か、ユーザー企業にとってどういうメリットがあるのか、という資料をまず、ご提供するようにします。11月の公開を目標としていますが、時間がかかる理由は「単に各社の製品パンフレットを一覧表にしてまとめたものには、しない。」というコンセプトを掲げているためです。ベンダー視点ではなく、ユーザー視点の資料とはどうあるべきか、この議論から入っていきます。これから正念場を迎えますが、1社単独ではつくれないような資料としてまとめることができれば、これは大きな価値をもつことになるだろうと考えています。</p></blockquote>

<p>これ、言い換えればSIerに残された仕事である、</p>

<p>どういう業務にはどのツールが適しているかということの判断は、</p>

<p>超高速開発コミュニティにおまかせあれということですね。</p>

<p>ということで、SIerにあげる仕事なんてありません、ってな感じになると思います。</p>

<h3>直感</h3>

<p>なーんて、無責任なことをジャスミンティーを飲みながらテキトーに書いているわけですが、</p>

<p>ここで書いている意見は記事を読んだプログラマーとしての意見ではなく、</p>

<p>超高速開発ツールとして上げられているGeneXusというソフトを使ったことがある</p>

<p>という経験からの直感で書いています。</p>

<h4>一応GeneXusの紹介(メリット)</h4>

<p>GeneXusというツールですが、</p>

<p>データベースの項目の定義</p>

<ul>
<li>カラム名</li>
<li>データ型(文字列、数値、日付、画像など)</li>
<li>空の値を許容する／しない</li>
<li>一意な値</li>
</ul>


<p>を作成すれば、scaffoldが自動で作成されて、</p>

<p>デプロイボタンを押せばサーバーにデプロイされるというツールになっています。</p>

<p>もちろんscaffoldだけでなく、</p>

<p>自由に画面をつくって(WYSIWYGな画面エディターつき)、</p>

<p>どのデータのどの項目を表示・入力させるといった設定をするだけで、</p>

<p>任意の業務画面を作成出来ます。</p>

<p>また、どの権限のユーザーがどの画面から業務を開始することができて、</p>

<p>どの権限のユーザーがどの画面で業務内容を把握して承認させるといった</p>

<p>フローの作成もできますし、その通知メールを送信するといったことも</p>

<p>ツールに仕様を記述すれば可能です。</p>

<p>また、設計書とか仕様書の管理について、</p>

<p>「(最新版)◯◯画面仕様_20130809_2.xlsx」といったファイルを</p>

<p>「Y:¥共有¥10仕様書¥2013-08-09最新¥30△△業務」フォルダーで管理するとか</p>

<p>そんなくだらない煩わしいことからも開放されます。</p>

<p>すべての仕様はデータベースに管理されており、</p>

<p>常に最新の仕様を把握することが可能です。</p>

<p>(履歴はどうだったか忘れた…)</p>

<p>また、日本ではどうだか知りませんが、</p>

<p>海外、特にアメリカとベネズエラでは、</p>

<p>コミュニティ活動も活発で、</p>

<p>セキュリティイシューなどのパッチもすぐ提供されますし、</p>

<p>単なるWeb業務アプリケーションを超えて、</p>

<p>AndroidやiPhone、iPad向けの業務アプリケーションも作成出来ます。</p>

<h4>一応GeneXusの紹介(デメリット)</h4>

<p>まあ、ここまではGeneXusの研修を受けた時の、売り文句をそのまま書いただけです。</p>

<p>(あれ、守秘義務なんとか…まあ、いいか、業務情報でないし)</p>

<p>メリットばかりを書いていてはアンフェアなので、</p>

<p>デメリットも書いておきます。</p>

<p>プログラミングレスを謳っていますが、</p>

<p>独自の業務プロセスに適合させようとすると、</p>

<p>GeneXusの独自言語での開発が求められます。</p>

<p>一応、オブジェクト指向っぽい言語ですが、</p>

<p>VB6っぽい感じの言語であり、</p>

<p>オブジェクト指向な割にはエディターの補完が効かないので、</p>

<p>どのオブジェクトにはどういうメンバー・メソッドがあって、</p>

<p>どういう責務を果たしているといった</p>

<p>独自言語に対する知識が求められます。</p>

<p>また、ユーザーが云々と上では述べましたが、</p>

<p>ユーザー認証に関する機能は各自で作りこまないといけません。</p>

<p>その実装の参考例はコミュニティのページから参照できますが、</p>

<p>英語で書かれているうえ、なんか古いバージョンのツールでの方法だったりします。</p>

<p>また、サポートについて、各ベンダーに質問すると、</p>

<p>大体一週間以内に回答がもらえますが、</p>

<p>コミュニティのページで得られる情報の日本語訳であることが多く、</p>

<p>また、日本語が上手でないのか的はずれな回答をすることが多く、</p>

<p>あまり頼りにならなかったという印象があります。</p>

<p>また、ツールに関する各種情報もコミュニティのページで得ることができますが、</p>

<p>多くの情報がスペイン語(ベネズエラで開発されているので当然といえば当然)であり、</p>

<p>英語のものがなかなか手にはいらないことや、</p>

<p>日本語情報が希薄という点については気をつけておかなければならないところでしょう。</p>

<p>(ちなみに、僕の第二外国語はスペイン語なので特に不自由しませんでしたが…)</p>

<p>また、対応しているブラウザーがIEとFireFoxだけで、</p>

<p>ChromeとかOperaに対応していませんでした。</p>

<p>(当然、Mac OS Xも…)</p>

<p>また、グラフを扱う場合にはFlashが必要なようです。</p>

<p>まあ、これらの情報は数年前のものなので、</p>

<p>今は変わっているかもしれませんが…</p>

<h4>研修の参加者</h4>

<p>僕はSIerとしてベンダーが開催する研修(結構なお値段)に参加していたわけですが、</p>

<p>研修の他の参加者は、企業のIT部門の人ばかりでした。</p>

<p>なので、SIerがこのツールを使って、ユーザーにどうこうするというよりは、</p>

<p>企業がこのツールを使って自社のシステムをどうこうするという位置なのでしょう。</p>

<h4>ベンダーの選定について</h4>

<p>技術的な課題というのは大抵のプロジェクトで発生します。</p>

<p>その課題への対応としてArtech社(GeneXusの開発会社)に問い合わせる場合に、</p>

<p>スペイン語が必須になるので、ベンダーがスペイン語ができるかどうかというのは、</p>

<p>見極めのポイントになります。</p>

<p>(とはいえ、GeneXusを売っているベンダーなんて数社しかありませんが…)</p>

<p>あと、ちゃんとした日本語ができるベンダーであるというのも</p>

<p>見極めのポイントになります…(???)</p>

<h3>超高速開発コミュニティが目指すべきところ</h3>

<p>まあ、GeneXusを触ったことがあるという観点から、</p>

<p>思いつくままに書いてきたわけですが、まとめとか書いといた方が良い気がして行きました。</p>

<h4>超高速開発ツールのターゲット</h4>

<p>ITに大金(60人月=6,000万円)を投資できないけど、</p>

<p>ITを必要としていて、小額(1,000万円程度)なら投資できるといった企業は、</p>

<p>これらのツールの恩恵を預かるのがよいかもしれません。</p>

<p>したがって、超高速開発コミュニティのターゲットは、</p>

<p>SIerなどではなく、あくまで小さくてたくさんいるユーザーであると認識しています。</p>

<h4>各ベンダーにはコミュニケーションが求められる</h4>

<p>また、先ほどちゃんとした日本語を使えるベンダーという言い回しを使いました。</p>

<p>これは、ベンダーが単なるスペイン語の逐語訳を回答するのではなく、</p>

<p>ユーザー企業のIT担当者のレベルでコミュニケーションを取るという</p>

<p>これまでSIerが担っていた部分をベンダーが担わないと、</p>

<p>これらのツールは広まらないのではないかと思っています。</p>

<p>なお、「そういったユーザー企業との折衝はSIerが」ってなると、</p>

<p>また要件定義が云々、仕様書が云々となって元の木阿弥に戻ります。</p>

<h4>超高速開発ツールに精通した技術者の育成</h4>

<p>とはいえ、ベンダーが複数の企業とコミュニケーションを取るというのは、</p>

<p>現実的ではないので、</p>

<p>超高速開発ツールに習熟した企業等が開発の請負などをしてくるのではないかと思います。</p>

<p>で、その企業に勤めている技術者がツールに精通することが</p>

<p>超高速開発ツール普及のポイントでしょう。</p>

<p>技術者がツールに精通していくためには、</p>

<p>商用では使えないけど、個人で使う分には無料であるような</p>

<p>ツールの無償版が求められるでしょう。</p>

<p>また、そのツールを使って、</p>

<p>ちょっと小銭稼ぎしちゃった、(・ω&lt;)ﾃﾍﾍﾟﾛといった技術者が出てきても、</p>

<p>お咎めしないような寛容さがないとちょっと厳しいかなとおもいます。</p>

<h4>ネガティブ情報も共有すること</h4>

<p>ベンダーの提供するツールの情報というのは、たいてい成功事例ばっかりな気がします。</p>

<p>売り込みをかける分にはそれでよいかもしれませんが、</p>

<p>技術者の普及のためには、</p>

<p>本当に価値のある情報 = 失敗事例なども共有して貰いたいと思っています。</p>

<p>こういった情報を技術者が共有・討論・研究して、</p>

<p>ツールを開発している会社にフィードバックされないと、</p>

<p>何度も同じ失敗を繰り返すだろうし、</p>

<p>ツール自体も魅力的にならないと思っています。</p>

<h4>本当の競合相手はSalesforce、Google</h4>

<p>超高速開発といったところで、</p>

<p>単純にはあるものを再利用しようという考えなわけで、</p>

<p>より多くの業務ノウハウを持っている会社が本当の競合相手であると思っています。</p>

<p>したがって、SalesforceやGoogleといった会社が超高速開発ツールの</p>

<p>競合相手であると認識しています。</p>

<p>日本への浸透度という点でも超強力です。</p>

<p>本の出版数やコミュニティの勢いを指標に浸透度を比較しますが、</p>

<p>日本ではGeneXusに関する書籍は1冊しかありませんが、</p>

<p>SalesforceやGoogle Appsに関する本はたくさんあります。</p>

<p>SalesforceやGoogle Appsに関する本は駅前の本屋さんにおいてありますが、</p>

<p>GeneXusに関する本は新宿Book Firstとか紀伊国屋に行かないとありません。</p>

<p>Google Appsのコミュニティはユーザーレベルで作られていますし、</p>

<p>Salesforceは勉強会・カンファレンスを積極的に主催しています。</p>

<p>これらのコミュニティや勉強会への参加は無料だったりします。</p>

<p>この勢力と渡り合うためには、</p>

<p>コミュニティ自体がベンダーだけにとどまったものではなく、</p>

<p>ユーザー・デベロッパーに開かれたものであることが求められるでしょう。</p>

<p>参加費1万円とか5万円とか徴収している場合ではないと思っています。</p>

<p>以上。</p>

<h2>P.S.</h2>

<p>まあ、こういったことを昨日・一昨日と某イケメン氏と話したりしていました。</p>

<blockquote class="twitter-tweet"><p>昨日<a href="https://twitter.com/mike_neck">@mike_neck</a>とも話してたけどツール・手法のいいとこ、成功事例ばっかじゃなくて、その陰に隠れたたくさんの失敗事例、良いと思って選定したけどこういう場面にはあわなかったﾃﾍﾍﾟﾛとか貴重な情報だけどOSSじゃないツールのそういう情報って埋もれてるだろうし、ベンダは話さない</p>&mdash; 山本裕介 (@yusuke) <a href="https://twitter.com/yusuke/statuses/365767543815806976">August 9, 2013</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>




<blockquote class="twitter-tweet"><p><a href="https://twitter.com/search?q=%23%E8%B6%85%E9%AB%98%E9%80%9F%E9%96%8B%E7%99%BA&amp;src=hash">#超高速開発</a>、最適なツール/手法を積極的に普及させる的な趣旨は良いと思うけどベンダじゃなくてユーザーが主体でやる方が良いんじゃないかと。ベンダが集まって作る比較表とか話半分にしか受け取らないしね。その情報を得るのにお金払うってのもよくわからん。ロックインされにお金払う人いるのかな</p>&mdash; 山本裕介 (@yusuke) <a href="https://twitter.com/yusuke/statuses/365767171822981120">August 9, 2013</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>




<!-- admax -->


<script type="text/javascript" src="http://adm.shinobi.jp/s/d0f95faac716337846b3bcf82925c26e"></script>


<!-- admax -->




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40855644-1', 'github.io');
  ga('send', 'pageview');

</script>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/17/execute-ant-setting-output-to-another-stream/">Groovyでantログの出力先を変更する</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-17T14:43:00+09:00" pubdate data-updated="true">Jul 17<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://groovy.codehaus.org/images/groovy-logo-medium.png" style="width : 450px;"></p>

<p>こんにちわ、みけです。</p>

<p>groovyでantのタスクでいろいろと大量のタスクを実行させている時に、</p>

<p>標準出力に出てくるログがちょっとうざったい時があります。</p>

<p>その場合に、ログの出力先のstreamを変更することができるようです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="c1">// 出力先のstream</span>
</span><span class='line'><span class="kt">def</span> <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">()</span>
</span><span class='line'><span class="c1">// antの出力先を変更 </span>
</span><span class='line'><span class="n">ant</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AntBuilder</span><span class="o">()</span>
</span><span class='line'><span class="n">ant</span><span class="o">.</span><span class="na">project</span><span class="o">.</span><span class="na">buildListeners</span><span class="o">.</span><span class="na">each</span><span class="o">{</span>
</span><span class='line'>    <span class="n">it</span><span class="o">.</span><span class="na">outputPrintStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PrintStream</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// 大量のタスクを実行</span>
</span><span class='line'><span class="o">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">100</span><span class="o">).</span><span class="na">each</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">ant</span><span class="o">.</span><span class="na">echo</span> <span class="s2">&quot;this is $it time log.&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>このスクリプトを実行すると次のような標準出力になります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="mi">1</span><span class="o">..</span><span class="mi">100</span>
</span></code></pre></td></tr></table></div></figure>


<p>実際にはこのstreamを外部のファイルにしておくと後で実行結果だけを参照するなどできます。</p>

<!-- admax -->


<script type="text/javascript" src="http://adm.shinobi.jp/s/d0f95faac716337846b3bcf82925c26e"></script>


<!-- admax -->




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40855644-1', 'github.io');
  ga('send', 'pageview');

</script>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/09/trying-gradle-setupbuild-task-of-gradle-1-dot-7-rc1/">GradleのsetupBuildタスクを試してみた</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-09T10:54:00+09:00" pubdate data-updated="true">Jul 9<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>こんにちわ。みけです。</p>

<p>前回の記事、<a href="http://mike-neck.github.io/blog/2013/07/06/gradle1-dot-7-release-notes-translation/">gradle1.7のリリースノート超意訳</a>で、</p>

<p>いくつか気になる機能があったので試してみることにしました。</p>

<hr />

<p>今回は、<a href="http://mike-neck.github.io/blog/2013/07/06/gradle1-dot-7-release-notes-translation/#c1_8">setupBuildタスク</a>を試してみます。</p>

<p>リリースノートでは</p>

<ul>
<li>javaプラグインが適用されたシンプルなビルドファイル</li>
<li>サンプルのプロダクションクラスとディレクトリー</li>
<li>サンプルのJUnitテストとディレクトリー</li>
<li>Gradle Wrapperファイル</li>
</ul>


<p>が生成されるとありました。</p>

<p>では実際に試してみたいと思います。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir sample
</span><span class='line'>$ cd sample/
</span><span class='line'>$ ll
</span><span class='line'>total 0
</span><span class='line'>drwxr-xr-x  2 mike  staff    68B  7  9 11:19 .
</span><span class='line'>drwxr-xr-x  3 mike  staff   102B  7  9 11:16 ..
</span><span class='line'>$ gradle setupBuild --type java-library
</span><span class='line'>:wrapper
</span><span class='line'>:setupBuild
</span><span class='line'>
</span><span class='line'>BUILD SUCCESSFUL
</span><span class='line'>
</span><span class='line'>Total time: 6.362 secs
</span><span class='line'>$ ll
</span><span class='line'>total 40
</span><span class='line'>drwxr-xr-x  9 mike  staff   306B  7  9 11:19 .
</span><span class='line'>drwxr-xr-x  3 mike  staff   102B  7  9 11:16 ..
</span><span class='line'>drwxr-xr-x  3 mike  staff   102B  7  9 11:19 .gradle
</span><span class='line'>-rw-r--r--  1 mike  staff   1.2K  7  9 11:19 build.gradle
</span><span class='line'>drwxr-xr-x  3 mike  staff   102B  7  9 11:19 gradle
</span><span class='line'>-rwxr-xr-x  1 mike  staff   5.0K  7  9 11:19 gradlew
</span><span class='line'>-rw-r--r--  1 mike  staff   2.3K  7  9 11:19 gradlew.bat
</span><span class='line'>-rw-r--r--  1 mike  staff   645B  7  9 11:19 settings.gradle
</span><span class='line'>drwxr-xr-x  4 mike  staff   136B  7  9 11:19 src</span></code></pre></td></tr></table></div></figure>


<p>お、見事プロジェクトが作成されています。</p>

<p>また、wrapperタスクを実行した後の状態になっていることもわかります。</p>

<p>(gradleディレクトリー、gradlewファイルとgradlew.batファイルが生成されている)</p>

<p>では、build.gradleの中身を見てみたいと思います。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cat build.gradle 
</span><span class='line'>/*
</span><span class='line'> * This build file was auto generated by running the Gradle 'buildSetup' task
</span><span class='line'> * by 'mike' at '13/07/09 11:19' with Gradle 1.7-rc-1
</span><span class='line'> *
</span><span class='line'> * This generated file contains a sample Java project to get you started.
</span><span class='line'> * For more details take a look at the Java Quickstart chapter in the Gradle
</span><span class='line'> * user guide available at http://gradle.org/docs/1.7-rc-1/userguide/tutorial_java_projects.html
</span><span class='line'> */
</span><span class='line'>
</span><span class='line'>// Apply the java plugin to add support for Java
</span><span class='line'>apply plugin: 'java'
</span><span class='line'>
</span><span class='line'>// In this section you declare where to find the dependencies of your project
</span><span class='line'>repositories {
</span><span class='line'>    // Use 'maven central' for resolving your dependencies.
</span><span class='line'>    // You can declare any Maven/Ivy/file repository here.
</span><span class='line'>    mavenCentral()
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>// In this section you declare the dependencies for your production and test code
</span><span class='line'>dependencies {
</span><span class='line'>    // The production code uses the SLF4J logging API at compile time
</span><span class='line'>    compile 'org.slf4j:slf4j-api:1.7.5'
</span><span class='line'>
</span><span class='line'>    // Declare the dependency for your favourite test framework you want to use in your tests.
</span><span class='line'>    // TestNG is also supported by the Gradle Test task. Just change the
</span><span class='line'>    // testCompile dependency to testCompile 'org.testng:testng:6.8.1' and add
</span><span class='line'>    // 'test.useTestNG()' to your build script.
</span><span class='line'>    testCompile "junit:junit:4.11"
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>作成されたbuild.gradleファイルでは</p>

<ul>
<li>javaプラグインが適用されている</li>
<li>slf4jがコンパイル用のライブラリーとして登録されている</li>
<li>JUnitがテスト用のライブラリーとして登録されている</li>
</ul>


<p>ようです。</p>

<p>また、サンプルのプロダクションコードとテストコードが生成されるということですが、</p>

<ul>
<li><code>src/main/java/Library.java</code></li>
<li><code>src/test/java/LibraryTest.java</code></li>
</ul>


<p>の二つのファイルが作成されています。</p>

<p>それぞれの中身は次のようになっています。</p>

<figure class='code'><figcaption><span>Library.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * This Java source file was auto generated by running &#39;gradle buildSetup --type java-library&#39;</span>
</span><span class='line'><span class="cm"> * by &#39;mike&#39; at &#39;13/07/09 11:19&#39; with Gradle 1.7-rc-1</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * @author mike, @date 13/07/09 11:19</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Library</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">someLibraryMethod</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>LibraryTest.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.*;</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> * This Java source file was auto generated by running &#39;gradle buildSetup --type java-library&#39;</span>
</span><span class='line'><span class="cm"> * by &#39;mike&#39; at &#39;13/07/09 11:19&#39; with Gradle 1.7-rc-1</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> * @author mike, @date 13/07/09 11:19</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LibraryTest</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Test</span> <span class="kd">public</span> <span class="kt">void</span> <span class="n">testSomeLibraryMethod</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Library</span> <span class="n">classUnderTest</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Library</span><span class="o">();</span>
</span><span class='line'>        <span class="n">assertTrue</span><span class="o">(</span><span class="s">&quot;someLibraryMethod should return &#39;true&#39;&quot;</span><span class="o">,</span> <span class="n">classUnderTest</span><span class="o">.</span><span class="na">someLibraryMethod</span><span class="o">());</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>実際にこのコードを使うことはないと思いますが、</p>

<p>これまでmavenライクなディレクトリーを作るのが面倒だったので、</p>

<p>この<code>setupBuild</code>タスクができたことはGradleユーザーには朗報ですね。</p>

<!-- admax -->


<script type="text/javascript" src="http://adm.shinobi.jp/s/d0f95faac716337846b3bcf82925c26e"></script>


<!-- admax -->




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40855644-1', 'github.io');
  ga('send', 'pageview');

</script>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/06/gradle1-dot-7-release-notes-translation/">gradle1.7のリリースノート超意訳</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-06T19:23:00+09:00" pubdate data-updated="true">Jul 6<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="//googledrive.com/host/0B4hhdHWLP7RRZHRNTkNwZEYtdkE"/></p>

<p>こんにちわ、みけです。</p>

<p>現在、gradle1.7-rc1が利用できます。</p>

<p>リリースノートの超意訳をどうぞ。</p>

<hr />

<h2>Gradle Release Notes</h2>

<h4>Version 1.7-rc-1</h4>

<p>Gradle1.7になるとすごく速くなります。dependency解決とビルドスクリプトのコンパイルの改善をしました。Gradleユーザーみんなこの恩恵に預かれますが、でっかいプロジェクトだと、その効果はもっと顕著になります。パフォーマンスの改善とスケービリティがGradle1.7の主要なテーマになっています。</p>

<p>これらの改善点に加えて、Gradle1.7では面白い機能がついてきます。finalizer taskメカニズムによってタスクの結果がどうであれ、タスクの次に別のタスクを起動させることができるようになります。例えば、アプリケーションサーバーを起動するようなintegrationテスト(の失敗)の後にアプリケーションサーバーを終了させることができるようになります。コピーやアーカイブ生成時にファイルの重複をコントロールする機能が登場します。</p>

<p>Gradle1.7のBuild Setupプラグインの改善によりプロジェクトをテンプレートから生成する機能が利用可能になります。これにより新規プロジェクトの作成が簡単になります。</p>

<p>C++からネイティブバイナリーを作成する機能も進化します。ネイティブバイナリーの生成に関しては結構面倒な領域ですが、今後もGradleのこの分野での進化を期待して下さい。</p>

<p>Gradle1.7ではコア・テベロップチーム以外からのコントリビュートが多いのも特徴です。Gradle1.7に貢献してくださったデベロッパーの皆様に感謝しております。</p>

<h2>Table Of Contents</h2>

<h3><a href="#c1">新機能や追加機能</a></h3>

<ul>
<li><a href="#c1_1">より速いGradleビルド</a></li>
<li><a href="#c1_2">Finalizer tasks</a></li>
<li><a href="#c1_3">C++プロジェクトサポートの改善</a></li>
<li><a href="#c1_4">JCenter レポジトリーのサポート</a></li>
<li><a href="#c1_5">パターン・ベース・ファイル・コピー設定</a></li>
<li><a href="#c1_6">ファイル重複時のハンドリング機能</a></li>
<li><a href="#c1_7">Gradle Wrapperはビルドスクリプトを特にいじらなくても利用可能になります</a></li>
<li><a href="#c1_8">Javaライブラリーテンプレートプロジェクトの生成</a></li>
<li><a href="#c1_9">publicationのカスタマイズ &ndash; new publishingプラグインにおける</a></li>
<li><a href="#c1_10">複数のモジュールを一つのGradleプロジェクトから発行する</a></li>
<li><a href="#c1_11">TestNGパラメーターがテストレポートに出力されます</a></li>
<li><a href="#c1_12">テストタスクに標準的なレポートインターフェースを採用</a></li>
<li><a href="#c1_13">ビルドダッシュボードの改善</a></li>
<li><a href="#c1_14">JUnit XMLファイルでテストケースごとにテストの出力を表示するようになりました</a></li>
<li><a href="#c1_15">ApplicationプラグインでJVMパラメーターを指定できるようになります</a></li>
<li><a href="#c1_16">BndライブラリーのアップデートによりOSGiサポートが改善されました</a></li>
</ul>


<h3><a href="#c2">修正された問題</a></h3>

<h3><a href="#c3">非推奨となったもの</a></h3>

<ul>
<li><a href="#c3_1">テストレポートプロパティ</a></li>
</ul>


<h3><a href="#c4">潜在的な互換性に関わる変更</a></h3>

<ul>
<li><a href="#c4_1">インメモリーdependencyキャッシング</a></li>
<li><a href="#c4_2">incubatingのJaCoCoプラグインの変更</a></li>
<li><a href="#c4_3">incubatingのbuild-setupプラグインの変更</a></li>
<li><a href="#c4_4">incubatingのivy-publishプラグインにおけるタスク名の変更</a></li>
<li><a href="#c4_5">IvyPublicationのデフォルト<code>status</code>値が<code>integration</code>となり、<code>project.status</code>でなくなりました</a></li>
<li><a href="#c4_6">C++サポートの大幅な変更</a></li>
<li><a href="#c4_7"><code>ConfigureableReport</code>が<code>ConfigurableReport</code>に名称が変わりました</a></li>
<li><a href="#c4_8">テストがない場合テストタスクがスキップされるようになりました</a></li>
<li><a href="#c4_9">OSGiプラグインに使われているBndライブラリーがアップデートされました</a></li>
</ul>


<h3><a href="#c5">コントリビューター</a></h3>

<h3><a href="#c6">既知の問題</a></h3>

<hr />

<p><span id="c1"></span></p>

<h3>新機能や追加機能</h3>

<p><span id="c1_1"></span></p>

<h5>より速いGradleビルド</h5>

<p>Gradle1.7でのビルドはより速くなります。</p>

<ul>
<li>dependency解決が速くなります(ほとんどのビルドで改善効果が現れます)</li>
<li>テスト実行が高速化されます(特にログを大量に出力しているようなGradleで顕著です)</li>
<li>ビルドスクリプトのコンパイルが速くなります(Gradle1.6に比べて75%の時間でできるようになります)</li>
<li>並行実行モードが高速になります</li>
</ul>


<p><span id="c1_2"></span></p>

<h5>Finalizer tasks <small>incubating</small></h5>

<p>Gradle1.7から新しいタスク実行ルールが導入され、タスク終了時に他のタスクを起動することができるようになります。この機能は<a href="https://github.com/erdi">Marcin Erdmann</a>氏によるものです。</p>

<p><a href="http://www.gradle.org/docs/release-candidate/userguide/more_about_tasks.html#N10F84">Finalizer tasks</a>ではタスク終了時にそのタスクの結果にかかわらず別のタスクを起動します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">configure</span><span class="o">([</span><span class="n">integTest1</span><span class="o">,</span> <span class="n">integTest2</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">dependsOn</span> <span class="n">startAppServer</span>
</span><span class='line'>    <span class="n">finalizedBy</span> <span class="n">stopAppServer</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>この例では<code>integTest1</code>タスクと<code>integTest2</code>タスクの終了時に<code>stopAppServer</code>タスクを実行するように宣言されています。どちらか片方のタスクがビルドの最中に起動された場合もfinalizer taskが自動で実行されます。ビルドの最中に両方のタスクが起動された場合でも必ず両方のタスクの最後にfinalizer taskが実行されます。finalizer taskの<code>stopAppServer</code>はGradle実行時に起動タスクとして指定する必要はありません。</p>

<p><span id="c1_3"></span></p>

<h5>C++プロジェクトサポートの改善 <small>incubating</small></h5>

<p>GradleはC++プロジェクトのサポートをしていました。これはGradleをネイティブコードプロジェクトのビルドツールとして最良のものにする改善になります。</p>

<ul>
<li>スタティックライブラリーの作成、リンク作成</li>
<li>異なるC++ツールチェインでも利用可能になります(Visual C++、GCCなど)</li>
<li>異なるアーキテクチャー、ビルドタイプ、OSへの対応</li>
<li>Variantに基づいた依存性解決</li>
<li>その他もろもろ(詳しくは<a href="https://github.com/gradle/gradle/blob/master/design-docs/continuous-delivery-for-c-plus-plus.md">こちら</a>を見て下さい(英語))</li>
</ul>


<p><span id="c1_4"></span></p>

<h5>JCenter レポジトリーのサポート <small>incubating</small></h5>

<p><a href="https://bintray.com/bintray/jcenter">Bintray&rsquo;s JCenter Repository</a>からdependencyを取得できるようになります。<code>jcenter()</code>レポジトリーノーテーションにより利用可能です。JCenterはコミュニティリポジトリーで、<a href="https://bintray.com/">Bintray</a>から無料で配布可能です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">jcenter</span><span class="o">()</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>このスクリプトにより<a href="http://jcenter.bintray.com">http://jcenter.bintray.com</a>がApache Maven repositoryと同様にリポジトリーリストに追加されます。</p>

<p><span id="c1_5"></span></p>

<h5>パターン・ベース・ファイル・コピー設定 <small>incubating</small></h5>

<p>Gradle1.7ではきめ細かい設定によりどのファイルがコピーされるべきかを定義することができます。設定方法は&#8221;Ant Patterns&#8221;のように指定出来ます。この機能は<a href="https://github.com/kylewm">Kyle Marhan</a>氏によるものです。</p>

<p>GradleにはファイルコピーのAPI(<a href="http://www.gradle.org/docs/release-candidate/javadoc/org/gradle/api/file/CopySpec.html">CopySpec</a>)があり、アーカイブすることもできます。この新しい機能はより強力なものとなります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">task</span> <span class="nf">copyFiles</span><span class="o">(</span><span class="n">type</span> <span class="o">:</span> <span class="n">Copy</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">from</span> <span class="s1">&#39;src/files&#39;</span>
</span><span class='line'>    <span class="n">into</span> <span class="s2">&quot;$buildDir/copied-files&quot;</span>
</span><span class='line'>    <span class="c1">// Replace the version number variable in only the text files</span>
</span><span class='line'>    <span class="n">filesMaching</span><span class="o">(</span><span class="s1">&#39;**/*.txt&#39;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">expand</span> <span class="nl">version:</span> <span class="s1">&#39;1.0&#39;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>fileMatching</code>メソッドではClosureを引数に取り、<a href="http://www.gradle.org/docs/release-candidate/javadoc/org/gradle/api/file/FileCopyDetails.html"><code>FileCopyDetails</code></a>オブジェクトの設定を行うことができます。これと反対の動作をする<a href="http://www.gradle.org/docs/release-candidate/javadoc/org/gradle/api/file/CopySpec.html#filesNotMatching%28java.lang.String%2C%20org.gradle.api.Action%29"><code>filesNotMatching</code></a>というメソッドもあり、パターンに該当しないファイルすべてを指定することもできます。</p>

<p><span id="c1_6"></span></p>

<h5>ファイル重複時のハンドリング機能 <small>incubating</small></h5>

<p>ファイルのコピーやアーカイブするときに、よく重複することがあります。そのような重複が発生した場合の処理方法を設定できるようになります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">task</span> <span class="nf">zip</span><span class="o">(</span><span class="n">type</span> <span class="o">:</span> <span class="n">Zip</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">from</span> <span class="s1">&#39;dir1&#39;</span>
</span><span class='line'>    <span class="n">from</span> <span class="s1">&#39;dir2&#39;</span>
</span><span class='line'>    <span class="n">duplicatesStrategy</span> <span class="s1">&#39;exclude&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>処理方法には２つあります。<code>include</code>と<code>exclude</code>です。</p>

<p><code>include</code>ストラテジーの場合、既存のGradleの動作と変わりありません。後からコピーされたもので上書きされます。なお、実際に発生した場合には警告が出力されるようになります。アーカイブ(zip、jar)の場合は新しいものが作成されます。</p>

<p><code>exclude</code>ストラテジーの場合、重複したファイルは無視されます。最初にコピーされたファイルが最終的に使われ、その後のファイルは無視され続けます。アーカイブの場合も同様で、最初に作成されたら、同じファイル名のものは作成されません。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">task</span> <span class="nf">zip</span> <span class="o">(</span><span class="n">type</span> <span class="o">:</span> <span class="n">Zip</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">duplicatesStrategy</span> <span class="s1">&#39;exclude&#39;</span> <span class="c1">// default strategy</span>
</span><span class='line'>    <span class="n">from</span> <span class="o">(</span><span class="s1">&#39;dir1&#39;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">filesMatching</span><span class="o">(</span><span class="s1">&#39;**/*.xml&#39;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">duplicatesStrategy</span> <span class="s1">&#39;include&#39;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">from</span> <span class="o">(</span><span class="s1">&#39;dir2&#39;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">duplicatesStrategy</span> <span class="s1">&#39;include&#39;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><span id="c1_7"></span></p>

<h5>Gradle Wrapperはビルドスクリプトを特にいじらなくても利用可能になります <small>incubating</small></h5>

<p><a href="http://www.gradle.org/docs/release-candidate/userguide/gradle_wrapper.html">Gradle Wrapper</a>は<code>Wrapper</code>タスクを定義しなくても利用できるようになります。つまり<code>Wrapper</code>のためにビルドスクリプトをいじることはありません。</p>

<p><code>Wrapper</code>を利用するためには単純に次のコマンドを実行するだけです。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">$</span> <span class="n">gradle</span> <span class="n">wrapper</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>Wrapper</code>ファイルがこれにより生成・設定されて、現在使用しているGradleのバージョンを利用することができるようになります。</p>

<p>なお、<code>wrapper</code>タスクをカスタマイズしたい場合は、ビルドスクリプトを次のように変更します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">wrapper</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">gradleVersion</span> <span class="s1">&#39;1.6&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>もし既存の<code>Wrapper</code>タイプのタスクがある場合は、そちらが使われます。それ以外の場合はデフォルトの<code>wrapper</code>タスクが使用されます。</p>

<p><span id="c1_8"></span></p>

<h5>Javaライブラリーテンプレートプロジェクトの生成</h5>

<p>build-setupプラグインがプロジェクトタイプをサポートするようになりました。Gradle1.7ではjava-libraryタイプが利用可能です。このタイプで生成されるのは以下のとおりです。</p>

<ul>
<li>javaプラグインが適用されたシンプルなビルドファイル</li>
<li>サンプルのプロダクションクラスとディレクトリー</li>
<li>サンプルのJUnitテストとディレクトリー</li>
<li>Gradle Wrapperファイル</li>
</ul>


<p>Javaライブラリープロジェクトを作る場合は次のコマンドを実行するだけです(build.gradleファイルは必要ありません)。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">$</span> <span class="n">gradle</span> <span class="n">setupBuild</span> <span class="o">--</span><span class="n">type</span> <span class="n">java</span><span class="o">-</span><span class="n">library</span>
</span></code></pre></td></tr></table></div></figure>


<p>詳しくはこちらを<a href="http://www.gradle.org/docs/release-candidate/userguide/build_setup_plugin.html">Build Setup plugin</a>を参照して下さい。</p>

<p><span id="c1_9"></span></p>

<h5>publicationのカスタマイズ &ndash; new publishingプラグインにおける <small>incubating</small></h5>

<p>publishプラグインでアーカイブを発行するときにartifactの情報を明示的にカスタマイズできるようになりました。以前はartifactの情報はプロジェクトの情報から取得されていました。</p>

<p><code>MavenPublication</code>では<code>groupId</code>、<code>artifactId</code>と<code>version</code>情報を設定できるようになります。Mavenの<code>pom</code>の<code>packaging</code>の値も設定可能です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">publications</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mavenPub</span><span class="o">(</span><span class="n">MaenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">from</span> <span class="n">components</span><span class="o">.</span><span class="na">java</span>
</span><span class='line'>        <span class="n">groupId</span> <span class="s1">&#39;my.group.id&#39;</span>
</span><span class='line'>        <span class="n">artifactId</span> <span class="s1">&#39;my-publication&#39;</span>
</span><span class='line'>        <span class="n">version</span> <span class="s1">&#39;3.1&#39;</span>
</span><span class='line'>        <span class="n">pom</span><span class="o">.</span><span class="na">packaging</span> <span class="s1">&#39;pom&#39;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>IvyPublication</code>では<code>organisation</code>、<code>module</code>と<code>revision</code>を設定出来ます。<code>IvyModuleDescriptor</code>で<code>status</code>の値も設定可能です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">publications</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">ivyPub</span><span class="o">(</span><span class="n">IvyPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">from</span> <span class="n">components</span><span class="o">.</span><span class="na">java</span>
</span><span class='line'>        <span class="n">organisation</span> <span class="s1">&#39;my.org&#39;</span>
</span><span class='line'>        <span class="n">module</span> <span class="s1">&#39;my-module&#39;</span>
</span><span class='line'>        <span class="n">revision</span> <span class="s1">&#39;3&#39;</span>
</span><span class='line'>        <span class="n">descriptor</span><span class="o">.</span><span class="na">status</span> <span class="s1">&#39;milestone&#39;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>この機能のすごいところは、<code>module</code>や<code>artifactId</code>を設定することができることです。というのも、これまでは<code>project.name</code>を使っており、Gradleのビルドスクリプトで変更することができなかったためです。</p>

<p><span id="c1_10"></span></p>

<h5>複数のモジュールを一つのGradleプロジェクトから発行する <small>incubating</small></h5>

<p>publishプラグインでは複数のモジュールを一つのGradleプロジェクトから発行することが可能になります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">project</span><span class="o">.</span><span class="na">group</span> <span class="s1">&#39;org.cool.library&#39;</span>
</span><span class='line'><span class="n">publications</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">implJar</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">artifactId</span> <span class="s1">&#39;cool-library&#39;</span>
</span><span class='line'>        <span class="n">version</span> <span class="s1">&#39;3.1&#39;</span>
</span><span class='line'>        <span class="n">artifact</span> <span class="n">jar</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">apiJar</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">artifactId</span> <span class="s1">&#39;cool-library-api&#39;</span>
</span><span class='line'>        <span class="n">version</span> <span class="s1">&#39;3&#39;</span>
</span><span class='line'>        <span class="n">artifact</span> <span class="n">apiJar</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>これまでも可能でしたが、ここに示したような簡単な方法ではできませんでした。新しい<code>ivy-publish</code>、<code>maven-publish</code>プラグインでは簡単に出来ます。</p>

<p><span id="c1_11"></span></p>

<h5>TestNGパラメーターがテストレポートに出力されます <small>incubating</small></h5>

<p>TestNGでは<a href="http://testng.org/doc/documentation-main.html#parameters">parameterizing test methods</a>によってあるテストを複数回、異なるデータの入力でテストを行うことがサポートされています。以前のGradleのレポートでは、パラメタライズドテストは複数行にわたってレポートが出力されていましたが、そのテストの区別をすることができませんでした。テストレポートにはパラメーターの<code>toString()</code>メソッドによる値を出力できるようにし、どのデータによるテストかを区別できるようにしました。</p>

<figure class='code'><figcaption><span>ParameterizedTest.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">org.testng.annotations.*</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ParameterizedTest</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Test</span><span class="o">(</span><span class="n">dataProvider</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">aParameterizedTestCase</span><span class="o">(</span><span class="n">String</span> <span class="n">var1</span><span class="o">,</span> <span class="n">String</span> <span class="n">var2</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// do testing</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@DataProvider</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;1&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Object</span><span class="o">[][]</span> <span class="nf">provider1</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[][]</span> <span class="o">{</span>
</span><span class='line'>           <span class="o">{</span><span class="s">&quot;1&quot;</span><span class="o">,</span> <span class="s">&quot;2&quot;</span><span class="o">},</span>
</span><span class='line'>           <span class="o">{</span><span class="s">&quot;3&quot;</span><span class="o">,</span> <span class="s">&quot;4&quot;</span><span class="o">}</span>
</span><span class='line'>        <span class="o">};</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>上記のテストに対するレポートは次のように表示されます。</p>

<ul>
<li><code>aParameterizedTestCase(1, 2)</code></li>
<li><code>aParameterizedTestCase(3, 4)</code></li>
</ul>


<p>この情報はGradleのHTMLテストレポートとJUnit XMLファイルに反映されます。JUnit XMLファイルは一般的にテストの実行結果をCIサーバーに引き渡す役割を担っており、CIサーバーでパラメーターの情報を参照することが可能になります。</p>

<p><span id="c1_12"></span></p>

<h5>テストタスクに標準的なレポートインターフェースを採用</h5>

<p>レポートインターフェースによりレポートをコントロールする方法が提供されます。テストタスクではこのレポートインターフェースが採用されます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;java&#39;</span>
</span><span class='line'><span class="n">test</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">reports</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">html</span><span class="o">.</span><span class="na">enabled</span> <span class="o">=</span> <span class="kc">false</span>
</span><span class='line'>        <span class="n">junitXml</span><span class="o">.</span><span class="na">destination</span> <span class="o">=</span> <span class="n">file</span><span class="o">(</span><span class="s2">&quot;$buildDir/junit-xml&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>testタスクの提供する<a href="http://www.gradle.org/docs/release-candidate/javadoc/org/gradle/api/tasks/testing/TestReports.html">TestReports</a>型の<a href="http://www.gradle.org/docs/release-candidate/javadoc/org/gradle/api/reporting/ReportContainer.html"><code>ReportContainer</code></a>を通じて、HTMLによるテストレポートおよびJUnit XMLファイルの出力の制御を行えるようになります(これらのファイルは通常CIサーバーやその他のツールとテスト結果を共有するために使われます)。</p>

<p>これによりテストタスクも他のレポート生成タスクとAPIレベルで同等になります。また、不要であればJUnit XMLファイルを生成しないことも可能です。</p>

<p><span id="c1_13"></span></p>

<h5>ビルドダッシュボードの改善 <small>incubating</small></h5>

<p>上記の変更(テストタスクに標準的なレポートインターフェースを採用)は言い換えると、テストレポートが<a href="http://www.gradle.org/docs/release-candidate/userguide/buildDashboard_plugin.html">ビルドダッシュボード</a>に現れるということです。</p>

<p>なお、<code>buildDashbord</code>タスクは自動的にレポート系タスクと同時実行されます(Finalizerタスクの機能により実現されています)。</p>

<p><span id="c1_14"></span></p>

<h5>JUnit XMLファイルでテストケースごとにテストの出力を表示するようになりました <small>incubating</small></h5>

<p>この変更により<a href="http://jenkins-ci.org/">Jenkins</a>などのCIサーバーでよりよいテスト結果を得ることができます。</p>

<p>JUnit XMLファイルはテスト結果のフォーマットとしてデファクト・スタンダードです。たいていのCIサーバーはこのファイルをテストの実行結果として使っています。元々は「JUnit And Tasks」によって考えられたもので、JUnitとほぼ同時期に作られ、多くの局面で使われてきましたが、特に仕様が定められていませんでした。</p>

<p>このファイルにはテスト中の標準出力(<code>System.out</code>と<code>System.err</code>)の内容が収められています。これまでは出力は<em>クラスレベル</em>でのみ記録されていました。つまり、テストケース毎の出力が得られなかったわけです。しかしGradleでは「テストケース毎の出力」モードを利用することができるようになりました。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">test</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">reports</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">junitXml</span><span class="o">.</span><span class="na">outputPerTestCase</span> <span class="o">=</span> <span class="kc">true</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>このモードを使うと、XMLレポートはテストケースごとに作成されます。Jenkins CIサーバーではテストケース毎の結果を参照できるようになります。<code>outputPerTestCase = true</code>と設定しておくと、テストケース毎の出力が画面に表示されます。以前は<em>テストクラス</em>毎の出力でした。</p>

<p>Jenkinsの<a href="https://wiki.jenkins-ci.org/display/JENKINS/JUnit+Attachments+Plugin">JUnit Attachments Plugin</a>はこの機能とともに用いることで有効活用できます。</p>

<p><span id="c1_15"></span></p>

<h5>ApplicationプラグインでJVMパラメーターを指定できるようになります <small>incubating</small></h5>

<p><a href="https://github.com/multi-io">Olaf Kilschat</a>により<a href="http://www.gradle.org/docs/release-candidate/userguide/application_plugin.html">Application Plugin</a>はデフォルトのJVM引数を設定することができるようになります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;application&#39;</span>
</span><span class='line'><span class="n">applicationDefaultJvmArgs</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;-Dfile.encoding=UTF-8&#39;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p><span id="c1_16"></span></p>

<h5>BndライブラリーのアップデートによりOSGiサポートが改善されました</h5>

<p><a href="http://www.gradle.org/docs/release-candidate/userguide/osgi_plugin.html">OSGi</a>プラグインは<a href="http://www.aqute.biz/Bnd/Bnd">Bnd</a>ツールを使ってbundle manifestsを作成しています。Bndツールのバージョンが1.50.0から2.1.0に変更されます。</p>

<p>最も重要な変更点は&#8221;invokedynamic&#8221;命令を使うJavaコード用のmanifestが正確になることです。</p>

<p><span id="c2"></span></p>

<h3>修正された問題</h3>

<p>Gradle1.7で30の問題が修正されました。</p>

<ul>
<li><a href="http://issues.gradle.org/browse/GRADLE-642">[GRADLE-642]</a> &ndash; scala toolsまたはライブラリーが登録されていない場合にscalaタスクから出力されるエラーメッセージを修正</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-1289">[GRADLE-1289]</a> &ndash; &ldquo;create-project&#8221;コマンドによるスケルトンプロジェクト作成機能を提供</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-1372">[GRADLE-1372]</a> &ndash; wrapperタスクをビルトインタスクにしました</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-1387">[GRADLE-1387]</a> &ndash; Gradle Architypes機能を提供</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-1456">[GRADLE-1456]</a> &ndash; Application PluginにてJAVA_OPTS/APPL_OPTSを設定する方法を提供</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-1551">[GRADLE-1551]</a> &ndash; <a href="http://www.gradle.org/build_lifecycle.html%E3%81%AEtypo%E3%82%92%E4%BF%AE%E6%AD%A3">http://www.gradle.org/build_lifecycle.html%E3%81%AEtypo%E3%82%92%E4%BF%AE%E6%AD%A3</a></li>
<li><a href="http://issues.gradle.org/browse/GRADLE-1583">[GRADLE-1583]</a> &ndash; Gradleがivy configurationの表現をサポートしていない</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-1704">[GRADLE-1704]</a> &ndash; &ldquo;gradle &mdash;version&#8221;コマンドの日付フォーマットの修正</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-1742">[GRADLE-1742]</a> &ndash; CodeNarcの警告数の上限を設定できるようにした</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2171">[GRADLE-2171]</a> &ndash; zipファイル生成する場合に重複を回避するオプションを提供</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2519">[GRADLE-2519]</a> &ndash; <code>testReport = false</code>と指定していてもテストFAILURE時に存在しないファイルのURLが表示される</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2666">[GRADLE-2666]</a> &ndash; maven2GradleでNullpointerが発生</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2702">[GRADLE-2702]</a> &ndash; testRuntime/testCompile configurationがテストがなくても解決される</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2738">[GRADLE-2738]</a> &ndash; dependenciesで同じartifactの複数のバージョンを指定している場合、一番古いバージョンで解決される</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2752">[GRADLE-2752]</a> &ndash; 自分自身のライブラリーの古いバージョンに依存している場合に</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2760">[GRADLE-2760]</a> &ndash; <code>--parallel-threads</code>が内部的に4つまでしか使えない</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2765">[GRADLE-2765]</a> &ndash; XMLテストレポートを出力できない設定を追加</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2766">[GRADLE-2766]</a> &ndash; Ivy defaultConfMappingが解決に用いられない</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2780">[GRADLE-2780]</a> &ndash; Gradle1.6でスクリプトのコンパイルが劣化</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2790">[GRADLE-2790]</a> &ndash; Ivy dependency configuration mapping <code>'*-&gt;@'</code> がターゲットモジュールからすべてのconfigurationを含んでしまう</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2791">[GRADLE-2791]</a> &ndash; Ivy dependency configuration mapping で左項<code>'%'</code>が無視される</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2792">[GRADLE-2792]</a> &ndash; Ivy dependency configuration mapping で左項<code>'*,!A'</code>がAの解決時に含まれてしまう</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2793">[GRADLE-2793]</a> &ndash; Ivy dependency configuration mapping で右項<code>'#'</code>が不適切なターゲットconfigurationに解される</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2802">[GRADLE-2802]</a> &ndash; Wrapperのインストール/ダウンロードが<code>-g</code>、<code>--gradle-user-home</code>コマンドラインフラグを考慮しない</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2806">[GRADLE-2806]</a> &ndash; OSGiプラグインにBNDライブラリーの最新版を適用</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2808">[GRADLE-2808]</a> &ndash; <code>setting options.forkOptions.executable</code>と設定をしてjoint compileすると<code>NotSerializableException</code>が発生する</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2813">[GRADLE-2813]</a> &ndash; <code>project.exec()</code>でタスクを定義した場合、DSLが反映されない</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2815">[GRADLE-2815]</a> &ndash; <code>@Input</code>が<code>boolean</code>型のgetterで<code>is*</code>という名前のメソッドには適用されない</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2821">[GRADLE-2821]</a> &ndash; テストのないテストタスクのレポート出力時にTestReportタスクがエラーを出力</li>
<li><a href="http://issues.gradle.org/browse/GRADLE-2825">[GRADLE-2825]</a> &ndash; <code>strategy</code>が<code>include</code>に設定されていてもファイル重複の警告が出力される</li>
</ul>


<p><span id="c3"></span></p>

<h3>非推奨となったもの</h3>

<p>Gradleの進化にともなって置き換えられたものや無駄になったものは<em>非推奨</em>になり、次のメジャーバージョン(Gradle2.0)にて廃止されます。ユーザーガイドの<a href="http://www.gradle.org/docs/release-candidate/userguide/feature_lifecycle.html">Feature Lifecycle</a>を参照して下さい。</p>

<p>以下に示すのが今回非推奨となったものです。もし何かあれば<a href="http://forums.gradle.org/">Gradle Forums</a>で問題提起してください。</p>

<p><span id="c3_1"></span></p>

<h5>テストレポートプロパティ</h5>

<p>Testタスクが<a href="http://www.gradle.org/docs/release-candidate/dsl/org.gradle.api.tasks.testing.Test.html">Reporting</a>インターフェースを実装するようになりました。現状のレポート出力に関するAPIは非推奨になりました。</p>

<ul>
<li><code>disableTestReport()</code></li>
<li><code>enableTestReport()</code></li>
<li><code>isTestReport()</code></li>
<li><code>setTestReport()</code></li>
<li><code>getTestReportDir()</code></li>
<li><code>setTestReportDir()</code></li>
<li><code>getTestResultsDir()</code></li>
<li><code>setTestResultsDir()</code></li>
</ul>


<p>すべての非推奨となった機能は新しい<a href="http://www.gradle.org/docs/release-candidate/dsl/org.gradle.api.tasks.testing.Test.html">Reporting</a>機能でも利用可能ではあります。</p>

<p><span id="c4"></span></p>

<h3>潜在的な互換性に関わる変更</h3>

<p><span id="c4_1"></span></p>

<h5>インメモリーdependencyキャッシング</h5>

<p>パフォーマンスの改善により、Gradleはdependencyの記述を<em>ビルド全般</em>にわたってメモリーにキャッシュするようになりました。つまりビルドの最中にdependencyメタデータが変わると、その変更はGradleは検知されない場合があります。このようなことが発生するパターンは確かめられていませんが、理論上想定することができます。</p>

<p>詳しくは<a href="http://www.gradle.org/docs/release-candidate/release-notes#faster-gradle-builds">Faster Gradle Builds</a>を参照下さい。</p>

<p><span id="c4_2"></span></p>

<h5>incubatingのJaCoCoプラグインの変更</h5>

<p><a href="http://www.gradle.org/docs/release-candidate/userguide/jacoco_plugin.html">JaCoCoカバレージプラグイン</a>のいくつかのクラスのプロパティの名前が適切なものに置き換わりました。</p>

<ul>
<li><code>JaCoCoTaskExtension.destPath</code>は<code>destinationFile</code>になりました。</li>
<li><code>JaCoCoTaskExtension.classDumpPath</code>は<code>classDumpFile</code>になりました。</li>
<li><code>JaCoCoMerge.destFile</code>は<code>destinationFile</code>になりました。</li>
</ul>


<p><span id="c4_3"></span></p>

<h5>incubatingのbuild-setupプラグインの変更</h5>

<p><code>ConvertMaven2Gradle</code>、<code>GenerateBuildScript</code>と<code>GenerateSettingsScript</code>クラスが削除されました。それらは<code>SetupBuild</code>型の<code>buildSetup</code>タスクの一部となっています。</p>

<p>プラグインはbuild-setupタイプに基づいて異なるタイプ・名前のタスクを作成します。</p>

<p><code>setupWrapper</code>タスクは<code>wrapper</code>となっています。</p>

<p><span id="c4_4"></span></p>

<h5>incubatingのivy-publishプラグインにおけるタスク名の変更</h5>

<p>maven-publishプラグインとの統一性を計るため、IvyPublicationでivy.xmlを生成するタスクが変わりました。タスクの名前は<code>generateDescriptorFileFor${publication.name}Publication</code>となります。</p>

<p><span id="c4_5"></span></p>

<h5>IvyPublicationのデフォルト<code>status</code>値が<code>integration</code>となり、<code>project.status</code>でなくなりました <small>incubating</small></h5>

<p>Ivy publicationモデルからGradleプロジェクトモデルを分離するために、<code>ivy-publish</code>プラグインで発行する際に<code>project.status</code>の値は使われなくなりました。</p>

<p><code>IvyPublication</code>の<code>IvyModuleDescriptor</code>用に<code>status</code>の値が設定されていない場合、デフォルトのivyステータス(<code>'integration'</code>)が使われます。以前は<code>project.status</code>のデフォルト値である<code>'release'</code>が使われていました。</p>

<p><span id="c4_6"></span></p>

<h5>C++サポートの大幅な変更</h5>

<p>GradleのincubatingなC++サポートがメジャーアップデートします。多くのプラグイン、タスク、APIクラス、DSLが変わります。この変更に伴いほとんどのシンプルなC++ビルドを変更する必要があります。</p>

<p>既存のC++ビルドを今後もGradleで実行するための対策は2つあります。</p>

<ol>
<li>Gradleを1.6のままにして、C++のサポートが安定するのを待ちます。その後、更新します。</li>
<li>最新の変更にビルドを合わせるようにします。なお、新たにリリースされた場合には変更が発生する可能性があります。</li>
</ol>


<p><span id="c4_7"></span></p>

<h5><code>ConfigureableReport</code>が<code>ConfigurableReport</code>に名称が変わりました</h5>

<p>incubatingの<code>org.gradle.api.reporting.ConfigureableReport</code>クラスは<code>org.gradle.api.reporting.ConfigurableReport</code>クラスに変更されます。ミススペルが原因です。</p>

<p><span id="c4_8"></span></p>

<h5>テストがない場合テストタスクがスキップされるようになりました</h5>

<p>テストがない場合には、テストタスクは<em>スキップ</em>されるようになります。<a href="http://issues.gradle.org/browse/GRADLE-2702">GRADLE-2702</a></p>

<p>以前はテストがない場合であっても、テストが実行されていました。その結果、dependencyの解決が実行され、何もないテストレポートが出力されていました。この変更によりビルドが高速になります。また、既存のビルドに対して大きな影響は発生しません。</p>

<p><span id="c4_9"></span></p>

<h5>OSGiプラグインに使われているBndライブラリーがアップデートされました</h5>

<p><a href="http://www.gradle.org/docs/release-candidate/userguide/osgi_plugin.html">OSGiプラグイン</a>でbundle manifestの生成に使われていた<a href="http://www.aqute.biz/Bnd/Bnd">Bnd</a>ツールのバージョンが1.50.0から2.1.0に上がります。</p>

<p>この変更は重要なアップグレードですが、後方互換性があります。</p>

<p><span id="c5"></span></p>

<h3>コントリビューター</h3>

<p>Gradleコミュニティの他に、Gradleのディベロップメントチームは下記の人達にこのバージョンのGradleへの貢献に感謝します。</p>

<h5><a href="https://github.com/erdi">Marchin Erdmann</a></h5>

<ul>
<li>Finalizer tasks</li>
</ul>


<h5><a href="https://github.com/dstine">Dan Stine</a></h5>

<ul>
<li>CodeNrcプラグインのmaxPriorityViolations setting (<a href="http://issues.gradle.org/browse/GRADLE-1742">GRADLE-1742</a>)</li>
<li>ユーザーガイドの修正</li>
</ul>


<h5><a href="https://github.com/kylewm">Kyle Mahan</a></h5>

<ul>
<li>アーカイブ・コピー操作における重複への対処(<a href="http://issues.gradle.org/browse/GRADLE-2171">GRADLE-2171</a>)</li>
<li>パターン・ベース・ファイル・コピー設定</li>
</ul>


<h5><a href="https://github.com/sponiro">Robert Kühne</a></h5>

<ul>
<li>ユーザーガイドのスペルミス修正</li>
</ul>


<h5><a href="https://github.com/Vampire">Björn Kautler</a></h5>

<ul>
<li>Build Dashboard のサンプルの修正</li>
</ul>


<h5><a href="https://github.com/sgoings">Seth Goings</a></h5>

<ul>
<li>ユーザーガイドの修正</li>
</ul>


<h5><a href="https://github.com/sbennettmcleish">Scott Bennett-McLeish</a></h5>

<ul>
<li>ユーザーガイドの修正</li>
</ul>


<h5><a href="https://github.com/wujek-srujek">Wujek Srujek</a></h5>

<ul>
<li>wrapperのインストールロケーションに関する-gコマンドラインオプションの処理(<a href="http://issues.gradle.org/browse/GRADLE-2802">GRADLE-2802</a>)</li>
</ul>


<h5><a href="https://github.com/glaforge">Guillaume Laforge</a></h5>

<ul>
<li>OSGiプラグインのBndライブラリーアップデート(<a href="http://issues.gradle.org/browse/GRADLE-2806">GRADLE-2806</a>)</li>
</ul>


<h5><a href="https://github.com/yoav">Yoav Landman</a></h5>

<ul>
<li><code>jcenter()</code>メソッドによるレポジトリー定義(<a href="https://bintray.com/bintray/jcenter">Bintray&rsquo;s JCenter repository</a>)</li>
</ul>


<p><span id="c6"></span></p>

<h3>既知の問題</h3>

<p>今のところGradle1.7に問題は見つかっていません。</p>

<!-- admax -->


<script type="text/javascript" src="http://adm.shinobi.jp/s/d0f95faac716337846b3bcf82925c26e"></script>


<!-- admax -->




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40855644-1', 'github.io');
  ga('send', 'pageview');

</script>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/02/one-of-techniques-to-use-javafx-as-headless-browser/">JavaFXをヘッドレスブラウザーとして使うための基本テク #javafx</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-02T10:28:00+09:00" pubdate data-updated="true">Jul 2<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>こんにちわ、みけです。</p>

<p>JavaFXをヘッドレスブラウザーとして使おうとして、</p>

<p>いろいろとWebのリダイレクトにハマりまくっています。</p>

<p>で、今回はJavaFXをJavaFXのスレッド以外のスレッドから扱うTipsを集めました。</p>

<h2>Goal</h2>

<h4>期待していいこと</h4>

<ul>
<li>JavaFXの操作をJavaFXの外からする方法</li>
</ul>


<h4>期待してはいけないこと</h4>

<ul>
<li>GUIプログラミングの云々かんぬん</li>
</ul>


<h2>Basics</h2>

<p>JavaFXのアプリケーションのサンプル的な起動方法は次のとおりです。</p>

<figure class='code'><figcaption><span>SampleApplication.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">javafx.application.Application</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javafx.stage.Stage</span><span class="o">;</span>
</span><span class='line'><span class="c1">// この中のmainメソッドからアプリケーションを起動しちゃう</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleApplication</span> <span class="kd">extends</span> <span class="n">Application</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Application</span><span class="o">.</span><span class="na">launch</span><span class="o">(</span><span class="n">SampleApplication</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">Stage</span> <span class="n">stage</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// do something.</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>さて、この方法を採用している限りにおいては、</p>

<p>JavaFXのスレッドがどうのこうのでハマることはありません。</p>

<p>今回のテーマはJavaFXアプリケーションの外と内をわけることにあります。</p>

<p>JavaFXアプリケーションはバックグラウンドで実行します。</p>

<p>そのためには<code>java.util.concurrent.ExecutorService</code>を用います。</p>

<figure class='code'><figcaption><span>ApplicationLauncher.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">javafx.application.Application</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javafx.application.Platform</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutorService</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>
</span><span class='line'><span class="c1">// 先ほどのSampleApplicationを起動します。</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationLauncher</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ExecutorService</span> <span class="n">SERVICE</span> <span class="o">=</span>
</span><span class='line'>            <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// launch application</span>
</span><span class='line'>        <span class="n">SERVICE</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">(){</span>
</span><span class='line'>            <span class="nd">@Override</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">Application</span><span class="o">.</span><span class="na">launch</span><span class="o">(</span><span class="n">SampleApplication</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">});</span>
</span><span class='line'>        <span class="c1">// do something</span>
</span><span class='line'>        <span class="c1">// shutdown application</span>
</span><span class='line'>        <span class="n">Platform</span><span class="o">.</span><span class="na">exit</span><span class="o">();</span>
</span><span class='line'>        <span class="n">SERVICE</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2><code>Platform#RunLater(java.lang.Runnable)</code></h2>

<p>JavaFX上でのみ動作するオブジェクトへの操作は<code>Platform#runLater(java.lang.Runnable)</code>を</p>

<p>通じて行います。</p>

<figure class='code'><figcaption><span>ControllerStimulation.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">javafx.application.Platform</span><span class="o">;</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ControllerStimulation</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// JavaFXのcontrollerクラスのインスタンス</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">SampleController</span> <span class="n">controller</span><span class="o">;</span>
</span><span class='line'>    <span class="c1">// Platform#runLater(Runnable)を通じてcontrollerクラスへの操作を行う。</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">simulateClickButton</span> <span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Platform</span><span class="o">.</span><span class="na">runLater</span><span class="o">(</span><span class="k">new</span> <span class="n">SimulateClickButton</span><span class="o">());</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="c1">// 実際にcontrollerクラスを操作するRunnable</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">SimulateClickButton</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span> <span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">controller</span><span class="o">.</span><span class="na">clickButton</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>戻り値を利用したい場合</h2>

<p>御存知の通り、<code>java.lang.Runnable#run()</code>は値を返しませんので、</p>

<p>値の受け渡しには<code>java.util.concurrent.BlockingQueue&lt;T&gt;</code>を使うことになります。</p>

<p><code>Platform#runLater</code>が<code>java.util.concurrent.Callable&lt;T&gt;</code>を引数にとって、</p>

<p><code>java.util.concurrent.Future&lt;T&gt;</code>を返してくれるといいんですけどね…</p>

<figure class='code'><figcaption><span>JavascriptExecution.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">javafx.application.Platform</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javafx.scene.web.WebEngine</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.concurrent.BlockingQueue</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.concurrent.LinkedBlockingQueue</span><span class="o">;</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavascriptExecution</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// controllerクラスのインスタンス</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">SampleController</span> <span class="n">controller</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">callJavascript</span><span class="o">(</span><span class="n">String</span> <span class="n">javascript</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">final</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;&gt;();</span>
</span><span class='line'>        <span class="n">Platform</span><span class="o">.</span><span class="na">runLater</span><span class="o">(</span><span class="k">new</span> <span class="n">CallJavascript</span><span class="o">(</span><span class="n">queue</span><span class="o">,</span> <span class="n">javascript</span><span class="o">));</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="na">take</span><span class="o">();</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">CallJavascript</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">private</span> <span class="kd">final</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">;</span>
</span><span class='line'>        <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">script</span><span class="o">;</span>
</span><span class='line'>        <span class="n">CallJavascript</span><span class="o">(</span><span class="kd">final</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">queue</span><span class="o">,</span> <span class="n">String</span> <span class="n">script</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">this</span><span class="o">.</span><span class="na">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="o">;</span>
</span><span class='line'>            <span class="k">this</span><span class="o">.</span><span class="na">script</span> <span class="o">=</span> <span class="n">script</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="nd">@Override</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">WebEngine</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="na">getEngine</span><span class="o">();</span>
</span><span class='line'>            <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">engine</span><span class="o">.</span><span class="na">executeScript</span><span class="o">(</span><span class="n">script</span><span class="o">);</span>
</span><span class='line'>            <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>実際はJavascriptなどでエラーがあると、<code>netscape.javascript.JSException</code>がthrowされるので、</p>

<p><code>Platform#runLater(java.lang.Runnable)</code>で<code>java.lang.RuntimeException</code>を検知して、</p>

<p>Applicatoinを終了させるような仕組みを組み込んでおくことが望まれるのですが、</p>

<p>それはここでの話を逸脱するし、誰得な気がするので、</p>

<p>やめておく…</p>

<p>以下、実際に僕が書いているコード</p>

<p><a href="https://googledrive.com/host/0B4hhdHWLP7RRQVYweDh2QU1LVk0" target="_blank"><img src="//googledrive.com/host/0B4hhdHWLP7RRQVYweDh2QU1LVk0" style="width : 450px;"></a></p>

<!-- admax -->


<script type="text/javascript" src="http://adm.shinobi.jp/s/d0f95faac716337846b3bcf82925c26e"></script>


<!-- admax -->




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40855644-1', 'github.io');
  ga('send', 'pageview');

</script>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/01/using-javafx-as-headless-browser/">JavaFXをheadless browserとして使うためのJSObjectの扱い方 - 1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-01T13:03:00+09:00" pubdate data-updated="true">Jul 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>こんにちわ。</p>

<p>みけです。</p>

<p>JavaFXでjavascriptのテスティングフレームワークを作ろうと思ってから、</p>

<p>早1年半。</p>

<p>全然成果があがっていません。</p>

<p>今日は、そんな自分のための俺得なエントリー。</p>

<p><img src="//googledrive.com/host/0B4hhdHWLP7RRbkltQVpjMUkzNE0" style="width : 450px;"/></p>

<h2>Goal</h2>

<h4>期待していいこと</h4>

<ul>
<li>JSObjectでのarrayの取り扱い</li>
</ul>


<h4>期待できないこと</h4>

<ul>
<li>JavaFXのスレッドの同期方法</li>
<li>JSObjectでのobjectの取り扱い</li>
</ul>


<h2>JSObjectの扱い方 &ndash; array編</h2>

<p><code>JSObject#getSlot(int)</code>を使ってarrayの要素を取得します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">final</span> <span class="n">String</span> <span class="n">script</span> <span class="o">=</span> <span class="s">&quot;(function(){return [&#39;a&#39;, 2, &#39;c&#39;, 4, &#39;e&#39;];})()&quot;</span><span class="o">;</span>
</span><span class='line'><span class="kd">final</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">JSObject</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;&gt;();</span>
</span><span class='line'><span class="n">Platform</span><span class="o">.</span><span class="na">runLater</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">((</span><span class="n">JSObject</span><span class="o">)</span> <span class="n">webEngine</span><span class="o">.</span><span class="na">executeScript</span><span class="o">(</span><span class="n">script</span><span class="o">));</span>
</span><span class='line'><span class="o">});</span>
</span><span class='line'><span class="n">JSObject</span> <span class="n">array</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="na">take</span><span class="o">();</span>
</span><span class='line'><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="s">&quot; -&gt; &quot;</span> <span class="o">+</span> <span class="n">array</span><span class="o">.</span><span class="na">getSlot</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>結果は次のようになります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">a</span>
</span><span class='line'><span class="mi">1</span> <span class="o">-&gt;</span> <span class="mi">2</span>
</span><span class='line'><span class="mi">2</span> <span class="o">-&gt;</span> <span class="n">c</span>
</span><span class='line'><span class="mi">3</span> <span class="o">-&gt;</span> <span class="mi">4</span>
</span><span class='line'><span class="mi">4</span> <span class="o">-&gt;</span> <span class="n">e</span>
</span></code></pre></td></tr></table></div></figure>


<p>ちなみに要素のindexより多い数を<code>JSObject#getSLot(int)</code>の引数に渡すと、</p>

<p><code>String</code>の<code>undefined</code>が返ってきます。</p>

<!-- admax -->


<script type="text/javascript" src="http://adm.shinobi.jp/s/d0f95faac716337846b3bcf82925c26e"></script>


<!-- admax -->




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40855644-1', 'github.io');
  ga('send', 'pageview');

</script>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/30/first-shibuya-java/">第一回渋谷javaに行ってきた</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-30T15:05:00+09:00" pubdate data-updated="true">Jun 30<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://atnd.org/events/40140">第一回渋谷java</a>というのに行って来ました。</p>

<p>javaの勉強会としては比較的若い人の集まった勉強会だったと思います。</p>

<hr />

<p>自己紹介で「好きなEclipseのショートカットは？」とか聞かれたので、</p>

<p>相変わらずのことで「Eclipse氏ね」と答えて来ました。</p>

<p>後、Eclipseの代替するエディターがvimだったので、</p>

<p>いや、IntelliJ IDEAですからとも自己紹介しておきました。</p>

<hr />

<p>一応タイトルはネタっぽいですが、</p>

<p>真面目な話をして来ました。</p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/23694003" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>


<hr />

<p>他の参加者のブログがいくつかあるようです。</p>

<ul>
<li><a href="http://d.hatena.ne.jp/jflute/20130629/1372519117">新たなるJavaの風景、渋谷javaがスタート！</a></li>
<li><a href="http://blog.k11i.biz/2013/06/java.html">第１回 #渋谷Java でトークしてきました</a></li>
<li><a href="http://hotchemi.hateblo.jp/entry/2013/06/29/230427">第1回渋谷Javaに行ってきた</a></li>
</ul>


<p>あと、いくつかスライドがアップロードされています。</p>

<p>JavaとOSS &ndash; ユーザーサイドから語ってみる</p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/23660334" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="http://www.slideshare.net/commonplace0807/java-23660334" title="渋谷Java第一回" target="_blank">渋谷Java第一回</a> </strong> from <strong><a href="http://www.slideshare.net/commonplace0807" target="_blank">commonplace0807</a></strong> </div></p>

<hr />

<p>今回は初回ということでLTだけでしたが、ハンズオンなども実施していくとのことです。</p>

<p>Eclipse強制されるのでなければ、行こうかなと思います。</p>

<!-- admax -->


<script type="text/javascript" src="http://adm.shinobi.jp/s/d0f95faac716337846b3bcf82925c26e"></script>


<!-- admax -->




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40855644-1', 'github.io');
  ga('send', 'pageview');

</script>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/27/java8-lambdashi-woshi-tutemita/">Java8 Lambda式を使ってみた</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-27T22:24:00+09:00" pubdate data-updated="true">Jun 27<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>こんにちわ、みけです。</p>

<p>Java8初心者勉強会というのを開催してみました。</p>

<p>参加者2人でした。</p>

<p>Java8はだれも興味ないんだなと思いました。</p>

<h2>Java8のラムダ式</h2>

<p>特にもうこれといって目新しいこともありません。</p>

<p>メソッドが一つだけのインターフェースを記述するときに、</p>

<p>非常に記述が楽になるというものです。</p>

<p>例えば次のようなクラスがあるとします。</p>

<figure class='code'><figcaption><span>Item.jara</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">final</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Item</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getPrice</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">price</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>上記の<code>Item</code>クラスを<code>price</code>の昇順、<code>name</code>の昇順でソートするコードは以下のようになります。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="n">items</span> <span class="o">=</span> <span class="n">getItemList</span><span class="o">();</span>
</span><span class='line'><span class="n">items</span><span class="o">.</span><span class="na">sort</span><span class="o">((</span><span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">priceOrder</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()</span> <span class="o">-</span> <span class="n">right</span><span class="o">.</span><span class="na">getPrice</span><span class="o">();</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">nameOrder</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span>
</span><span class='line'>            <span class="n">compareTo</span><span class="o">(</span><span class="n">right</span><span class="o">.</span><span class="na">getNmae</span><span class="o">());</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">priceOrder</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">?</span> <span class="n">priceOrder</span> <span class="o">:</span> <span class="n">nameOrder</span><span class="o">;</span>
</span><span class='line'><span class="o">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>ところで、<code>Item</code>クラスの<code>price</code>だとか<code>name</code>だとかについて、</p>

<p>それをソートするという操作は別に外のクラスが実装しても構わないけど、</p>

<p><code>Item</code>クラスが持っている方が何かと便利です。</p>

<p>したがって、オーダーするにあたって、<code>Item</code>クラスに次のようなメソッドを</p>

<p>持たせるようにします。</p>

<figure class='code'><figcaption><span>Item.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">final</span> <span class="kt">int</span> <span class="n">price</span><span class="o">;</span>
</span><span class='line'>    <span class="c1">// 途中省略</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">comparePriceAscNameAsc</span> <span class="o">(</span><span class="n">Item</span> <span class="n">that</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kt">int</span> <span class="n">priceOrder</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">-</span> <span class="n">that</span><span class="o">.</span><span class="na">price</span><span class="o">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">priceOrder</span> <span class="o">!=</span> <span class="mi">0</span> <span class="n">priceOrder</span> <span class="o">:</span>
</span><span class='line'>                <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">that</span><span class="o">.</span><span class="na">name</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>先ほどのソートをするコードのラムダ式部分は非常に簡単化されます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">items</span><span class="o">.</span><span class="na">sort</span><span class="o">((</span><span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">left</span><span class="o">.</span><span class="na">comparePriceAscNameAsc</span><span class="o">(</span><span class="n">right</span><span class="o">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>ところで、呼び出されるメソッドはこのケースの場合わかりきっているので、</p>

<blockquote><p>TODO : この記述は適当に書いているのでドキュメントを読み直します</p></blockquote>

<p>Method Referenceに変更することが可能です。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">items</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="nl">Item:</span><span class="o">:</span><span class="n">comparePriceAscNameAsc</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>という感じで、ラムダ式っぽい記述はなくなりました。</p>

<p>ちなみにMethod and Constructor Referenceは<a href="http://cr.openjdk.java.net/~dlsmith/jsr335-0.6.1/C.html">Lambdaの仕様の一部</a>です。</p>

<!-- admax -->


<script type="text/javascript" src="http://adm.shinobi.jp/s/d0f95faac716337846b3bcf82925c26e"></script>


<!-- admax -->




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40855644-1', 'github.io');
  ga('send', 'pageview');

</script>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/21/how-to-publish-artifacts-with-gradle-maven-publish-plugin-version-1-dot-6/">How to Publish Artifacts to Maven Central Repository via Gradle Maven-publish Plugin (Version 1.6)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-21T14:04:00+09:00" pubdate data-updated="true">Jun 21<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://www.gradle.org/forum-assets/images/gradle_logo.gif"/></p>

<p>Gradle <strong>maven-publish plugin</strong> provides the easier way to publish artifacts than the old <strong>maven plugin</strong>.</p>

<p>This post introduces you the way to publish artifacts with <strong>maven-publish plugin</strong>.</p>

<p><strong>Please Note that</strong> maven-publish plugin is incubating feature. Its DSL may change later.</p>

<h2>Goal</h2>

<p>After reading this post, you can upload your artifacts to maven central repository via <strong>maven-publish plugin</strong>.</p>

<h2>Basics and Example</h2>

<p>To publish artifacts you should do these things.</p>

<ol>
<li>to declare applying <strong>maven-publish plugin</strong>.</li>
<li>to tell gradle which files should be published.</li>
<li>to tell gradle where to upload artifacts.</li>
</ol>


<p>Now let&rsquo;s see sample build script.</p>

<figure class='code'><figcaption><span>build.gradle</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="c1">// declaration of plugins (1)</span>
</span><span class='line'><span class="o">[</span><span class="s1">&#39;java&#39;</span><span class="o">,</span> <span class="s1">&#39;maven-publish&#39;</span><span class="o">].</span><span class="na">each</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">apply</span> <span class="n">plugin</span> <span class="o">:</span> <span class="n">it</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;com.yourdomain&#39;</span>
</span><span class='line'><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>
</span><span class='line'><span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mavenCentral</span> <span class="o">()</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">compile</span> <span class="s1">&#39;org.apache.commons:commons-lang3:3.1&#39;</span>
</span><span class='line'>    <span class="n">testCompile</span> <span class="s1">&#39;junit:junit:4.11&#39;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">publishing</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">publications</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">myPublication</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">// telling gradle to publish project&#39;s jar archive (2)</span>
</span><span class='line'>            <span class="n">from</span> <span class="n">components</span><span class="o">.</span><span class="na">java</span>
</span><span class='line'>            <span class="c1">// telling gradle to publish README file (2)</span>
</span><span class='line'>            <span class="n">artifact</span> <span class="o">(</span><span class="s1">&#39;README.txt&#39;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">classifier</span> <span class="o">=</span> <span class="s1">&#39;README&#39;</span>
</span><span class='line'>                <span class="n">extension</span>  <span class="o">=</span> <span class="s1">&#39;txt&#39;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="c1">// telling gradle to publish artifact to local directory (3)</span>
</span><span class='line'>    <span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">maven</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">url</span> <span class="s2">&quot;file:/${project.projectDir}/artifacts&quot;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this script you can publish your artifact via this command.</p>

<figure class='code'><figcaption><span>build.gradle</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">$</span> <span class="n">gradle</span> <span class="n">publish</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then you will find some file is generated at <code>artifact</code> directory.</p>

<p>These files are …</p>

<ul>
<li>sample-project.jar</li>
<li>sample-project.jar.md5</li>
<li>sample-project.jar.sha1</li>
<li>sample-project.pom</li>
<li>sample-project.pom.md5</li>
<li>sample-project.pom.sha1</li>
<li>sample-project-README.txt</li>
<li>sample-project-README.txt.md5</li>
<li>sample-project-README.txt.sha1</li>
</ul>


<h2>Conventions</h2>

<p><strong>maven-publish plugin</strong> has some conventions.</p>

<ul>
<li>base archive name is project name.</li>
<li><code>classifier</code> is given after the project name.</li>
<li><code>extension</code> is given after the project name and <code>classifier</code>.</li>
<li><code>classifier</code> and <code>extension</code> should be unique in all artifacts in a publication.</li>
</ul>


<h2>Publishing javadoc and source code as jar</h2>

<h3>javadoc</h3>

<p>Following shows the way to publish javadoc as jar.</p>

<ol>
<li>call javadoc task.</li>
<li>create a task of zipping javadoc and call it.</li>
<li>give th zipping task to <code>artifact</code> method in publication container.</li>
</ol>


<figure class='code'><figcaption><span>build.gradle</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="c1">// (2)</span>
</span><span class='line'><span class="n">task</span> <span class="nf">javadocJar</span> <span class="o">(</span><span class="nl">type:</span> <span class="n">Jar</span><span class="o">,</span> <span class="nl">dependsOn:</span> <span class="n">javadoc</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (1)</span>
</span><span class='line'>    <span class="n">classifier</span> <span class="o">=</span> <span class="s1">&#39;javadoc&#39;</span>
</span><span class='line'>    <span class="n">from</span> <span class="n">javadoc</span><span class="o">.</span><span class="na">destinationDir</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">publishing</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">publications</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">myPublication</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">artifact</span> <span class="o">(</span><span class="n">javadocJar</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (3)</span>
</span><span class='line'>                <span class="n">classifier</span> <span class="o">=</span> <span class="s1">&#39;javadoc&#39;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>source codes</h3>

<p>Following shows the way to publish source as jar.</p>

<ol>
<li>create a task of zipping sources as jar.</li>
<li>give the zipping task to <code>artifact</code> method in publication container.</li>
</ol>


<figure class='code'><figcaption><span>build.gradle</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="c1">// (1)</span>
</span><span class='line'><span class="n">task</span> <span class="nf">sourceJar</span> <span class="o">(</span><span class="n">type</span> <span class="o">:</span> <span class="n">Jar</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">classifier</span> <span class="o">=</span> <span class="s1">&#39;sources&#39;</span>
</span><span class='line'>    <span class="n">from</span> <span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">allSource</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">publishing</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">publications</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">myPublication</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">artifact</span> <span class="o">(</span><span class="n">sourceJar</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (2)</span>
</span><span class='line'>                <span class="n">classifier</span> <span class="o">=</span> <span class="s1">&#39;sources&#39;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Modifying POM</h2>

<h3>requirements</h3>

<p><strong>maven-publish plugin</strong> generates POM, but it lacks some elements required by Sonatype OSS repository. Folowing shows list of elements to be added.</p>

<ul>
<li><code>&lt;name&gt;</code> &ndash; the name of project</li>
<li><code>&lt;description&gt;</code> &ndash; the description for the project</li>
<li><code>&lt;url&gt;</code> &ndash; project&rsquo;s url</li>
<li><code>&lt;scm&gt;&lt;url&gt;</code> &ndash; repository url.</li>
<li><code>&lt;scm&gt;&lt;connection&gt;</code> &ndash; repository url for scm tool. for example using git &ndash; github, it becomes <code>scm:git:git://github.com/your-name/project-name.git</code></li>
<li><code>&lt;scm&gt;&lt;developerConnection&gt;</code> &ndash; repository url for scm tool via ssh. for example using git &ndash; github, it becomes <code>scm:git:ssh:git@github.com:your-name/project-name.git</code></li>
<li><code>&lt;licenses&gt;&lt;license&gt;&lt;name&gt;</code> &ndash; license name (i.e. <code>The Apache Software License, Version 2.0</code> etc…). In the case of the project being licensed under multiple license, <code>licenses</code> elements can have multiple <code>&lt;license&gt;</code> elements.</li>
<li><code>&lt;licenses&gt;&lt;license&gt;&lt;url&gt;</code> &ndash; license url (e.x. if the project is licensed under Apache version 2, it becomes <code>http://www.apache.org/license/LICENSE-2.0.txt</code>)</li>
<li><code>&lt;licenses&gt;&lt;license&gt;&lt;distribution&gt;</code> &ndash; <code>repo</code></li>
<li><code>&lt;developers&gt;&lt;developer&gt;&lt;id&gt;</code> &ndash; developer&rsquo;s id. If there are more than one developers, you can write <code>&lt;developer&gt;</code> elements more than one times.</li>
<li><code>&lt;developers&gt;&lt;developer&gt;&lt;name&gt;</code> &ndash; developer&rsquo;s name.</li>
<li><code>&lt;developers&gt;&lt;developer&gt;&lt;email&gt;</code> &ndash; developer&rsquo;s email.</li>
</ul>


<h3>build script</h3>

<p>To add these elements to POM, you can acces pom file via <code>pom</code> object&rsquo;s <code>withXml</code> method in <code>MavenPublication</code> container.</p>

<figure class='code'><figcaption><span>build.gradle</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">publishing</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">publications</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">myPublication</span> <span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">from</span> <span class="n">components</span><span class="o">.</span><span class="na">java</span>
</span><span class='line'>            <span class="n">pom</span><span class="o">.</span><span class="na">withXml</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">asNode</span><span class="o">().</span><span class="na">children</span><span class="o">().</span><span class="na">last</span><span class="o">()</span> <span class="o">+</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">resolveStrategy</span> <span class="o">=</span> <span class="n">Closure</span><span class="o">.</span><span class="na">DELEGATE_FIRST</span>
</span><span class='line'>                    <span class="n">name</span> <span class="s1">&#39;project-name&#39;</span>
</span><span class='line'>                    <span class="n">description</span> <span class="s1">&#39;description for project&#39;</span>
</span><span class='line'>                    <span class="n">url</span> <span class="n">projectUrl</span>
</span><span class='line'>                    <span class="n">scm</span> <span class="o">{</span>
</span><span class='line'>                        <span class="n">url</span> <span class="n">scmUrl</span>
</span><span class='line'>                        <span class="n">connection</span> <span class="n">connectionUrl</span>
</span><span class='line'>                        <span class="n">developerConnection</span> <span class="n">developerConnectionUrl</span>
</span><span class='line'>                    <span class="o">}</span>
</span><span class='line'>                    <span class="n">licenses</span> <span class="o">{</span>
</span><span class='line'>                        <span class="n">license</span> <span class="o">{</span>
</span><span class='line'>                            <span class="n">name</span> <span class="s1">&#39;The Apache Software License, Version 2.0&#39;</span>
</span><span class='line'>                            <span class="n">url</span> <span class="s1">&#39;http://www.apache.org/license/LICENSE-2.0.txt&#39;</span>
</span><span class='line'>                            <span class="n">distribution</span> <span class="s1">&#39;repo&#39;</span>
</span><span class='line'>                        <span class="o">}</span>
</span><span class='line'>                    <span class="o">}</span>
</span><span class='line'>                    <span class="n">developers</span> <span class="o">{</span>
</span><span class='line'>                        <span class="n">developer</span> <span class="o">{</span>
</span><span class='line'>                            <span class="n">id</span> <span class="s1">&#39;your id or nick name&#39;</span>
</span><span class='line'>                            <span class="n">name</span> <span class="s1">&#39;Your Name&#39;</span>
</span><span class='line'>                            <span class="n">email</span> <span class="s1">&#39;your@mail.address&#39;</span>
</span><span class='line'>                        <span class="o">}</span>
</span><span class='line'>                    <span class="o">}</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Signing Jar</h2>

<p>To keep quality of maven central repo, signing files is required.</p>

<p>These files should be signed.</p>

<ul>
<li>main jar (file name is <code>project-name.jar.asc</code>)</li>
<li>javadoc jar (file name is <code>project-name-javadoc.jar.asc</code>)</li>
<li>sources jar (file name is <code>project-name-sources.jar.asc</code>)</li>
<li>pom file (file name is <code>project-name.pom.asc</code>, on this signature this post will mention later)</li>
</ul>


<p>To sign archives is available via <strong>signing plugin</strong>.</p>

<figure class='code'><figcaption><span>build.gradle</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="c1">// adding &#39;signing&#39; plugin</span>
</span><span class='line'><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;signing&#39;</span>
</span><span class='line'><span class="c1">// summarize artifacts</span>
</span><span class='line'><span class="n">artifacts</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">archives</span> <span class="n">jar</span>
</span><span class='line'>    <span class="n">archives</span> <span class="n">sourceJar</span>
</span><span class='line'>    <span class="n">archives</span> <span class="n">javadocJar</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// sign all artifacts</span>
</span><span class='line'><span class="n">task</span> <span class="nf">signJars</span> <span class="o">(</span><span class="n">type</span> <span class="o">:</span> <span class="n">Sign</span><span class="o">,</span> <span class="nl">dependsOn:</span> <span class="o">[</span><span class="n">jar</span><span class="o">,</span> <span class="n">javadocJar</span><span class="o">,</span> <span class="n">sourceJar</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">sign</span> <span class="n">configurations</span><span class="o">.</span><span class="na">archives</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// call signJar task before publish task</span>
</span><span class='line'><span class="n">task</span> <span class="nf">preparePublish</span><span class="o">(</span><span class="nl">dependsOn:</span> <span class="n">signJar</span><span class="o">)</span>
</span><span class='line'><span class="c1">// extract signature file and give them proper name</span>
</span><span class='line'><span class="kt">def</span> <span class="n">getSignatureFiles</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">def</span> <span class="n">allFiles</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">signJars</span><span class="o">.</span><span class="na">signatureFiles</span><span class="o">.</span><span class="na">collect</span> <span class="o">{</span> <span class="n">it</span> <span class="o">}</span>
</span><span class='line'>    <span class="kt">def</span> <span class="n">signedSources</span> <span class="o">=</span> <span class="n">allFiles</span><span class="o">.</span><span class="na">find</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">name</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s1">&#39;-sources&#39;</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    <span class="kt">def</span> <span class="n">signedJavadoc</span> <span class="o">=</span> <span class="n">allFiles</span><span class="o">.</span><span class="na">find</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">name</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s1">&#39;-javadoc&#39;</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    <span class="kt">def</span> <span class="n">signedJar</span> <span class="o">=</span> <span class="o">(</span><span class="n">allFiles</span> <span class="o">-</span> <span class="o">[</span><span class="n">signedSources</span><span class="o">,</span> <span class="n">signedJavadoc</span><span class="o">])[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">[</span>
</span><span class='line'>            <span class="o">[</span><span class="nl">archive:</span> <span class="n">signedSources</span><span class="o">,</span> <span class="nl">classifier:</span> <span class="s1">&#39;sources&#39;</span><span class="o">,</span> <span class="nl">extension:</span> <span class="s1">&#39;jar.asc&#39;</span><span class="o">],</span>
</span><span class='line'>            <span class="o">[</span><span class="nl">archive:</span> <span class="n">signedJavadoc</span><span class="o">,</span> <span class="nl">classifier:</span> <span class="s1">&#39;javadoc&#39;</span><span class="o">,</span> <span class="nl">extension:</span> <span class="s1">&#39;jar.asc&#39;</span><span class="o">],</span>
</span><span class='line'>            <span class="o">[</span><span class="nl">archive:</span> <span class="n">signedJar</span><span class="o">,</span>     <span class="nl">classifier:</span> <span class="kc">null</span><span class="o">,</span>      <span class="nl">extension:</span> <span class="s1">&#39;jar.asc&#39;</span><span class="o">]</span>
</span><span class='line'>    <span class="o">]</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">publishing</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">publications</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">signatures</span> <span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">// give signature files to rtifact method</span>
</span><span class='line'>            <span class="n">getSignatureFiles</span><span class="o">().</span><span class="na">each</span> <span class="o">{</span><span class="n">signature</span> <span class="o">-&gt;</span>
</span><span class='line'>                <span class="n">artifact</span> <span class="o">(</span><span class="n">signature</span><span class="o">.</span><span class="na">archive</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">classifier</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="na">classifier</span>
</span><span class='line'>                    <span class="n">extension</span>  <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="na">extension</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Signing POM</h2>

<p>Before running <code>publish</code> task, there are no POM file, so calling signing POM task will fail. To avoid this, whether calling POM task or not is defined dynamicly. And writing POM is available <code>writeTo(File)</code> method via <code>XmlProviderContainer</code> (i.e. on the <code>Closure</code> block of <code>pom.withXml</code>)</p>

<figure class='code'><figcaption><span>build.gradle</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">ext</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">pomFilePath</span> <span class="o">=</span> <span class="s2">&quot;${project.projectDir}/tmp/pom.xml&quot;</span>
</span><span class='line'>    <span class="n">pomFile</span> <span class="o">=</span> <span class="n">file</span><span class="o">(</span><span class="n">pomFilePath</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">configurations</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">pom</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">artifacts</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">archives</span> <span class="n">jar</span>
</span><span class='line'>    <span class="n">archives</span> <span class="n">sourceJar</span>
</span><span class='line'>    <span class="n">archives</span> <span class="n">javadocJar</span>
</span><span class='line'>    <span class="nf">if</span> <span class="o">(</span><span class="n">pomFile</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">pom</span> <span class="n">pomFile</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">task</span> <span class="nf">signPom</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Sign</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">sign</span> <span class="n">configurations</span><span class="o">.</span><span class="na">pom</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="kt">def</span> <span class="n">getPomSignature</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">project</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">signPom</span><span class="o">.</span><span class="na">signatureFiles</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span><span class="n">it</span><span class="o">}[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="k">if</span> <span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">ext</span><span class="o">.</span><span class="na">pomFile</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">task</span> <span class="nf">preparePublication</span> <span class="o">(</span><span class="n">dependsOn</span> <span class="o">:</span> <span class="o">[</span><span class="n">signJars</span><span class="o">,</span> <span class="n">signPom</span><span class="o">])</span>
</span><span class='line'><span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">task</span> <span class="nf">preparePublication</span> <span class="o">(</span><span class="n">dependsOn</span> <span class="o">:</span> <span class="n">signJars</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">publishing</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">publications</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">jar</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">// publishing main jars</span>
</span><span class='line'>            <span class="n">pom</span><span class="o">.</span><span class="na">withXml</span> <span class="o">{</span>
</span><span class='line'>                <span class="c1">// add required elements</span>
</span><span class='line'>                <span class="c1">// here writing pom file</span>
</span><span class='line'>                <span class="k">if</span> <span class="o">(!</span><span class="n">project</span><span class="o">.</span><span class="na">ext</span><span class="o">.</span><span class="na">pomFile</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">writeTo</span> <span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">ext</span><span class="o">.</span><span class="na">pomFile</span><span class="o">)</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">gpgJars</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">// publishing signature of jars</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="c1">// dynamic publication definition</span>
</span><span class='line'>        <span class="c1">// pom file does exist signature of pom file is published</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">ext</span><span class="o">.</span><span class="na">pomFile</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">gpgPom</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">artifact</span> <span class="o">(</span><span class="n">getPomSignature</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">classifier</span> <span class="o">=</span> <span class="kc">null</span>
</span><span class='line'>                    <span class="n">extension</span>  <span class="o">=</span> <span class="s1">&#39;pom.asc&#39;</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">maven</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">ext</span><span class="o">.</span><span class="na">pomFile</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">url</span> <span class="n">sonatypeUrl</span>
</span><span class='line'>                <span class="n">credentials</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">username</span> <span class="o">=</span> <span class="n">sonatypeUsername</span>
</span><span class='line'>                    <span class="n">password</span> <span class="o">=</span> <span class="n">sonatypePassword</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">url</span> <span class="n">fileDirectory</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and execute gradle tasks as follows</p>

<figure class='code'><figcaption><span>build.gradle</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">$</span> <span class="n">gradle</span> <span class="n">clean</span> <span class="n">pP</span> <span class="n">publish</span>
</span><span class='line'><span class="n">$</span> <span class="n">gradle</span> <span class="n">clean</span> <span class="n">pP</span> <span class="n">publish</span>
</span></code></pre></td></tr></table></div></figure>


<p>You should execute gradle publish task twice.</p>

<ol>
<li>The first execution is generating pom file and publishing som artifacts to machine&rsquo;s directory.</li>
<li>The second execution is publishing pom signature to Sonatype OSS repository.</li>
</ol>


<h4>Please note…</h4>

<p><code>publish</code> task will execute publication tasks according to the alphabetiacl order of publishing task name. And each publication task will generate POM file. So please take care of publication name. The recomending name for publications is …</p>

<ul>
<li>gpgJars &ndash; publish signatures of jar files.</li>
<li>gpgPom &ndash; publish signature of POM.</li>
<li>jar &ndash; publish all jars and POM.</li>
</ul>


<h2>Credential</h2>

<p>You may know an account of Sonatype OSS is required to upload artifact into maven central repo. Here shows settings of sonatype account in <strong>maven-publish plugin</strong>.</p>

<figure class='code'><figcaption><span>build.gradle</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">publishing</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">url</span> <span class="s1">&#39;https://oss.sonatype.org/service/local/staging/deploy/maven2/&#39;</span>
</span><span class='line'>        <span class="n">credentials</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">username</span> <span class="o">=</span> <span class="n">sonatypeUsername</span>
</span><span class='line'>            <span class="n">password</span> <span class="o">=</span> <span class="n">sonatypePassword</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p>Taking these things in account, here is a perfect example script for publishing artifacts to maven central repo with <strong>maven-publish plugin</strong>.</p>

<figure class='code'><figcaption><span>build.gradle</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="o">[</span><span class="s1">&#39;java&#39;</span><span class="o">,</span> <span class="s1">&#39;siging&#39;</span><span class="o">,</span> <span class="s1">&#39;maven-publish&#39;</span><span class="o">].</span><span class="na">each</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">apply</span> <span class="nl">plguin:</span> <span class="n">it</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// project information</span>
</span><span class='line'><span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;com.yourdomain&#39;</span>
</span><span class='line'><span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>
</span><span class='line'><span class="c1">// dependency management as you like</span>
</span><span class='line'><span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mavenCentral</span> <span class="o">()</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">compile</span> <span class="s1">&#39;org.apache.commons:commons-lang3:3.1&#39;</span>
</span><span class='line'>    <span class="n">testCompile</span> <span class="s1">&#39;junit:junit:4.11&#39;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// javadoc.jar generation</span>
</span><span class='line'><span class="n">task</span> <span class="nf">javadocJar</span> <span class="o">(</span><span class="nl">type:</span> <span class="n">Jar</span><span class="o">,</span> <span class="nl">dependsOn:</span> <span class="n">javadoc</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// (1)</span>
</span><span class='line'>    <span class="n">classifier</span> <span class="o">=</span> <span class="s1">&#39;javadoc&#39;</span>
</span><span class='line'>    <span class="n">from</span> <span class="n">javadoc</span><span class="o">.</span><span class="na">destinationDir</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// sources.jar generation</span>
</span><span class='line'><span class="n">task</span> <span class="nf">sourceJar</span> <span class="o">(</span><span class="n">type</span> <span class="o">:</span> <span class="n">Jar</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">classifier</span> <span class="o">=</span> <span class="s1">&#39;sources&#39;</span>
</span><span class='line'>    <span class="n">from</span> <span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">allSource</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// pom file name</span>
</span><span class='line'><span class="n">ext</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">pomFilePath</span> <span class="o">=</span> <span class="s2">&quot;${project.projectDir}/tmp/pom.xml&quot;</span>
</span><span class='line'>    <span class="n">pomFile</span> <span class="o">=</span> <span class="n">file</span><span class="o">(</span><span class="n">pomFilePath</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// add configuration for pom signing</span>
</span><span class='line'><span class="n">configurations</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">pom</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// summarize artifacts</span>
</span><span class='line'><span class="n">artifacts</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">archives</span> <span class="n">jar</span>
</span><span class='line'>    <span class="n">archives</span> <span class="n">sourceJar</span>
</span><span class='line'>    <span class="n">archives</span> <span class="n">javadocJar</span>
</span><span class='line'>    <span class="nf">if</span> <span class="o">(</span><span class="n">pomFile</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">pom</span> <span class="n">pomFile</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// sign all artifacts</span>
</span><span class='line'><span class="n">task</span> <span class="nf">signJars</span> <span class="o">(</span><span class="n">type</span> <span class="o">:</span> <span class="n">Sign</span><span class="o">,</span> <span class="nl">dependsOn:</span> <span class="o">[</span><span class="n">jar</span><span class="o">,</span> <span class="n">javadocJar</span><span class="o">,</span> <span class="n">sourceJar</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">sign</span> <span class="n">configurations</span><span class="o">.</span><span class="na">archives</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// sign pom</span>
</span><span class='line'><span class="n">task</span> <span class="nf">signPom</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Sign</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">sign</span> <span class="n">configurations</span><span class="o">.</span><span class="na">pom</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// defining which tasks should be called</span>
</span><span class='line'><span class="k">if</span> <span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">ext</span><span class="o">.</span><span class="na">pomFile</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">task</span> <span class="nf">preparePublication</span> <span class="o">(</span><span class="n">dependsOn</span> <span class="o">:</span> <span class="o">[</span><span class="n">signJars</span><span class="o">,</span> <span class="n">signPom</span><span class="o">])</span>
</span><span class='line'><span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">task</span> <span class="nf">preparePublication</span> <span class="o">(</span><span class="n">dependsOn</span> <span class="o">:</span> <span class="n">signJars</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// extract signatures and add classifier and extension to them</span>
</span><span class='line'><span class="kt">def</span> <span class="n">getSignatureFiles</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">def</span> <span class="n">allFiles</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">signJars</span><span class="o">.</span><span class="na">signatureFiles</span><span class="o">.</span><span class="na">collect</span> <span class="o">{</span> <span class="n">it</span> <span class="o">}</span>
</span><span class='line'>    <span class="kt">def</span> <span class="n">signedSources</span> <span class="o">=</span> <span class="n">allFiles</span><span class="o">.</span><span class="na">find</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">name</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s1">&#39;-sources&#39;</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    <span class="kt">def</span> <span class="n">signedJavadoc</span> <span class="o">=</span> <span class="n">allFiles</span><span class="o">.</span><span class="na">find</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">name</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s1">&#39;-javadoc&#39;</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'>    <span class="kt">def</span> <span class="n">signedJar</span> <span class="o">=</span> <span class="o">(</span><span class="n">allFiles</span> <span class="o">-</span> <span class="o">[</span><span class="n">signedSources</span><span class="o">,</span> <span class="n">signedJavadoc</span><span class="o">])[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'>    <span class="k">return</span> <span class="o">[</span>
</span><span class='line'>            <span class="o">[</span><span class="nl">archive:</span> <span class="n">signedSources</span><span class="o">,</span> <span class="nl">classifier:</span> <span class="s1">&#39;sources&#39;</span><span class="o">,</span> <span class="nl">extension:</span> <span class="s1">&#39;jar.asc&#39;</span><span class="o">],</span>
</span><span class='line'>            <span class="o">[</span><span class="nl">archive:</span> <span class="n">signedJavadoc</span><span class="o">,</span> <span class="nl">classifier:</span> <span class="s1">&#39;javadoc&#39;</span><span class="o">,</span> <span class="nl">extension:</span> <span class="s1">&#39;jar.asc&#39;</span><span class="o">],</span>
</span><span class='line'>            <span class="o">[</span><span class="nl">archive:</span> <span class="n">signedJar</span><span class="o">,</span>     <span class="nl">classifier:</span> <span class="kc">null</span><span class="o">,</span>      <span class="nl">extension:</span> <span class="s1">&#39;jar.asc&#39;</span><span class="o">]</span>
</span><span class='line'>    <span class="o">]</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="c1">// extract pom signature</span>
</span><span class='line'><span class="kt">def</span> <span class="n">getPomSignature</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">project</span><span class="o">.</span><span class="na">tasks</span><span class="o">.</span><span class="na">signPom</span><span class="o">.</span><span class="na">signatureFiles</span><span class="o">.</span><span class="na">collect</span><span class="o">{</span><span class="n">it</span><span class="o">}[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">publishing</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">publicaitons</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">gpgJars</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">getSignatureFiles</span><span class="o">().</span><span class="na">each</span> <span class="o">{</span><span class="n">signature</span> <span class="o">-&gt;</span>
</span><span class='line'>                <span class="n">artifact</span> <span class="o">(</span><span class="n">signature</span><span class="o">.</span><span class="na">archive</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">classifier</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="na">classifier</span>
</span><span class='line'>                    <span class="n">extension</span>  <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="na">extension</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">ext</span><span class="o">.</span><span class="na">pomFile</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">gpgPom</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">artifact</span> <span class="o">(</span><span class="n">getPomSignature</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">classifier</span> <span class="o">=</span> <span class="kc">null</span>
</span><span class='line'>                    <span class="n">extension</span>  <span class="o">=</span> <span class="s1">&#39;pom.asc&#39;</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">jar</span><span class="o">(</span><span class="n">MavenPublication</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">from</span> <span class="n">components</span><span class="o">.</span><span class="na">java</span>
</span><span class='line'>            <span class="n">pom</span><span class="o">.</span><span class="na">withXml</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">asNode</span><span class="o">().</span><span class="na">children</span><span class="o">().</span><span class="na">last</span><span class="o">()</span> <span class="o">+</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">resolveStrategy</span> <span class="o">=</span> <span class="n">Closure</span><span class="o">.</span><span class="na">DELEGATE_FIRST</span>
</span><span class='line'>                    <span class="n">name</span> <span class="s1">&#39;project-name&#39;</span>
</span><span class='line'>                    <span class="n">description</span> <span class="s1">&#39;description for project&#39;</span>
</span><span class='line'>                    <span class="n">url</span> <span class="n">projectUrl</span>
</span><span class='line'>                    <span class="n">scm</span> <span class="o">{</span>
</span><span class='line'>                        <span class="n">url</span> <span class="n">scmUrl</span>
</span><span class='line'>                        <span class="n">connection</span> <span class="n">connectionUrl</span>
</span><span class='line'>                        <span class="n">developerConnection</span> <span class="n">developerConnectionUrl</span>
</span><span class='line'>                    <span class="o">}</span>
</span><span class='line'>                    <span class="n">licenses</span> <span class="o">{</span>
</span><span class='line'>                        <span class="n">license</span> <span class="o">{</span>
</span><span class='line'>                            <span class="n">name</span> <span class="s1">&#39;The Apache Software License, Version 2.0&#39;</span>
</span><span class='line'>                            <span class="n">url</span> <span class="s1">&#39;http://www.apache.org/license/LICENSE-2.0.txt&#39;</span>
</span><span class='line'>                            <span class="n">distribution</span> <span class="s1">&#39;repo&#39;</span>
</span><span class='line'>                        <span class="o">}</span>
</span><span class='line'>                    <span class="o">}</span>
</span><span class='line'>                    <span class="n">developers</span> <span class="o">{</span>
</span><span class='line'>                        <span class="n">developer</span> <span class="o">{</span>
</span><span class='line'>                            <span class="n">id</span> <span class="s1">&#39;your id or nick name&#39;</span>
</span><span class='line'>                            <span class="n">name</span> <span class="s1">&#39;Your Name&#39;</span>
</span><span class='line'>                            <span class="n">email</span> <span class="s1">&#39;your@mail.address&#39;</span>
</span><span class='line'>                        <span class="o">}</span>
</span><span class='line'>                    <span class="o">}</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">project</span><span class="o">.</span><span class="na">ext</span><span class="o">.</span><span class="na">pomFile</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">url</span> <span class="s1">&#39;https://oss.sonatype.org/service/local/staging/deploy/maven2/&#39;</span>
</span><span class='line'>                <span class="n">credentials</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">username</span> <span class="o">=</span> <span class="n">sonatypeUsername</span>
</span><span class='line'>                    <span class="n">password</span> <span class="o">=</span> <span class="n">sonatypePassword</span>
</span><span class='line'>                <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">url</span> <span class="n">fileDirectory</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and execute gradle tasks as follows</p>

<figure class='code'><figcaption><span>build.gradle</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">$</span> <span class="n">gradle</span> <span class="n">clean</span> <span class="n">pP</span> <span class="n">publish</span>
</span><span class='line'><span class="n">$</span> <span class="n">gradle</span> <span class="n">clean</span> <span class="n">pP</span> <span class="n">publish</span>
</span></code></pre></td></tr></table></div></figure>


<p>… Eh? <strong>maven plugin</strong> is easier than this way? <strong>You, right!</strong></p>

<p>But this plugin will become more smart, I believe.</p>

<blockquote class="twitter-tweet"><p><a href="https://twitter.com/mike_neck">@mike_neck</a> You&#39;re doing cool stuff with &#39;maven-publish&#39;: latest gradle nightly has ability to set GAV of publication, too. Docs soon.</p>&mdash; Daz DeBoer (@dazdeboer) <a href="https://twitter.com/dazdeboer/statuses/347938407252635648">June 21, 2013</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>




<!-- admax -->


<script type="text/javascript" src="http://adm.shinobi.jp/s/d0f95faac716337846b3bcf82925c26e"></script>


<!-- admax -->




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40855644-1', 'github.io');
  ga('send', 'pageview');

</script>



</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/08/19/jjug-ltda-hui-dehua-sitanei-rong-falseyao-dian/">JJUG LT大会で話した内容の要点</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/08/chao-gao-su-kai-fa-turuniguan-siteiroirotosi-tutakoto/">超高速開発ツールに関していろいろと思ったこと</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/17/execute-ant-setting-output-to-another-stream/">Groovyでantログの出力先を変更する</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/09/trying-gradle-setupbuild-task-of-gradle-1-dot-7-rc1/">GradleのsetupBuildタスクを試してみた</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/06/gradle1-dot-7-release-notes-translation/">gradle1.7のリリースノート超意訳</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/mike-neck">@mike-neck</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'mike-neck',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<a href="https://twitter.com/mike_neck" class="twitter-follow-button" data-show-count="false" data-lang="ja">@mike_neckさんをフォロー</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/110183156583475779298?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<script type="text/javascript"><!--
amazon_ad_tag = "kkkjkrt-22"; amazon_ad_width = "160"; amazon_ad_height = "600"; amazon_ad_logo = "hide"; amazon_ad_link_target = "new"; amazon_ad_price = "retail"; amazon_ad_border = "hide"; amazon_color_border = "303030"; amazon_color_background = "E0E0E0"; amazon_color_text = "4B4B4B"; amazon_color_link = "4B4B4B"; amazon_color_price = "4B4B4B"; amazon_color_logo = "E0E0E0";//--></script>
<script type="text/javascript" src="http://www.assoc-amazon.jp/s/ads.js"></script>
<h3>Manning Items</h3>
<p>
<a href="http://affiliate.manning.com/idevaffiliate.php?id=1272_277_1_74" target="_blank"><img border="0" src="http://affiliate.manning.com/banners/Node.js_300x250.gif" width="300" height="250" alt=""></a>
<br/>
<a href="http://affiliate.manning.com/idevaffiliate.php?id=1272_270_1_71" target="_blank"><img border="0" src="http://affiliate.manning.com/banners/Netherland_300x250.gif" width="300" height="250" alt="blog banner"></a>
<br/>
<a href="http://affiliate.manning.com/idevaffiliate.php?id=1272_267_1_68" target="_blank"><img border="0" src="http://affiliate.manning.com/banners/SpringBatch_300x250.gif" width="300" height="250" alt=""></a>
<br/>
<a href="http://affiliate.manning.com/idevaffiliate.php?id=1272_266_1_66" target="_blank"><img border="0" src="http://affiliate.manning.com/banners/SpringRoo_300x250.gif" width="300" height="250" alt=""></a>
<br/>
<a href="http://affiliate.manning.com/idevaffiliate.php?id=1272_259_1_59" target="_blank"><img border="0" src="http://affiliate.manning.com/banners/MachineLearning_300x250.gif" width="300" height="250" alt=""></a>
<br/>
<a href="http://affiliate.manning.com/idevaffiliate.php?id=1272_249_1_48" target="_blank"><img border="0" src="http://affiliate.manning.com/banners/MacRuby_300x250.gif" width="300" height="250" alt=""></a>
<br/>
<a href="http://affiliate.manning.com/idevaffiliate.php?id=1272_238_1_47" target="_blank"><img border="0" src="http://affiliate.manning.com/banners/ScalainDepth_300x250.gif" width="300" height="250" alt=""></a>
<br/>
<a href="http://affiliate.manning.com/idevaffiliate.php?id=1272_211_1_49" target="_blank"><img border="0" src="http://affiliate.manning.com/banners/ContIntegration_300x250.gif" width="300" height="250" alt=""></a>
<br/>
<a href="http://affiliate.manning.com/idevaffiliate.php?id=1272_154_1_55" target="_blank"><img border="0" src="http://affiliate.manning.com/banners/Dependency_300x250.gif" width="300" height="250" alt=""></a>
<br/>
<a href="http://affiliate.manning.com/idevaffiliate.php?id=1272_112_1_22" target="_blank"><img border="0" src="http://affiliate.manning.com/banners/Skeet.gif" width="217" height="55" alt=""></a>
<br/>
<a href="http://affiliate.manning.com/idevaffiliate.php?id=1272_59_1_54" target="_blank"><img border="0" src="http://affiliate.manning.com/banners/Groovy2E_300x250.gif" width="300" height="250" alt=""></a>
<p>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - mike-neck -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
